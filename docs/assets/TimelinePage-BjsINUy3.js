const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Timeline-B_h87p4b.js","assets/index-DpljZKJp.js","assets/router-DLfkpT9n.js","assets/google-login-button-CK2bO50y.js","assets/rolldown-runtime-CWU8vmCm.js","assets/react-query-BB-sDLdC.js","assets/ui-icons-ZvUVfxiW.js","assets/react-vendor-B0_zmQzX.js","assets/zod-BU_exWGf.js","assets/index-Csiy6FS7.css","assets/exportTimelineToPDF-Cd-dNzo9.js","assets/jspdf.es.min-ByXr749M.js","assets/typeof-_tCs8JoZ.js"])))=>i.map(i=>d[i]);
import{C as e,S as t}from"./google-login-button-CK2bO50y.js";import"./react-vendor-B0_zmQzX.js";import{c as n,n as r}from"./router-DLfkpT9n.js";import"./react-query-BB-sDLdC.js";import{C as i,W as a}from"./ui-icons-ZvUVfxiW.js";import"./zod-BU_exWGf.js";import{J as o,f as s,g as c,q as l}from"./index-DpljZKJp.js";import"./useMediaQuery-CwI1DZ8K.js";import{t as u}from"./PageHeader-CCV96RX0.js";import{i as d,r as f,t as p}from"./useOSRMRoutesQuery-BDNF4dAd.js";var m=e(),h=t(),g=(0,m.lazy)(()=>n(()=>import(`./Timeline-B_h87p4b.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])));function _(e,t){if(e.length===0||t.length===0)return e;let n=e[0].city,r=t.find(e=>e.city===n);return!r?.lat||!r?.lng?e:[{id:-999,name:r.description,lat:r.lat,lng:r.lng,city:r.city,region:e[0].region,country:r.country,order:0,date:e[0].date,day:e[0].day,dayOfWeek:e[0].dayOfWeek,type:`other`,duration:0,couplePrice:0,priceInBRL:0,currency:e[0].currency,visited:!1,needsReservation:!1,openingTime:void 0,closingTime:void 0,imageUrl:void 0},...e]}function v(){let{country:e,day:t}=o(),{attractions:v,isLoading:y,toggleVisited:b}=c(e),{accommodations:x}=d(),{segmentsByDay:S,isRoutesLoading:C}=p((0,m.useMemo)(()=>{let e={};return v.filter(e=>e.lat!=null&&e.lng!=null).forEach(t=>{e[t.day]||(e[t.day]=[]),e[t.day].push(t)}),e},[v]),x),{success:w,error:T}=l(),[E,D]=(0,m.useState)(!1),O=(0,m.useCallback)(async e=>{try{await b(e),w(`Status da atração atualizado`)}catch(e){T(`Erro ao atualizar atração`),console.error(e)}},[b,w,T]),k=(0,m.useMemo)(()=>v.filter(e=>e.lat&&e.lng),[v]),A=(0,m.useMemo)(()=>k.length===0||t===`all`?[]:_(k.filter(e=>e.day===t),x),[k,t,x]),j=(0,m.useMemo)(()=>{if(t!==`all`||k.length===0)return[];let e={};return k.forEach(t=>{e[t.day]||(e[t.day]=[]),e[t.day].push(t)}),Object.keys(e).map(Number).sort((e,t)=>e-t).map(t=>{let n=e[t],r=_(n,x);return{day:t,date:n[0].date,attractions:r}})},[t,k,x]),M=(0,m.useMemo)(()=>t===`all`?j.length===0?`Todos os dias`:`${j.length} ${j.length===1?`dia`:`dias`}`:A.length===0?``:`Dia ${t}`,[t,j.length,A.length]),N=t===`all`?j.length>0:A.length>0,P=(0,m.useMemo)(()=>t===`all`?JSON.stringify(j.map(e=>({day:e.day,ids:e.attractions.map(e=>({id:e.id,visited:e.visited}))}))):JSON.stringify(A.map(e=>({id:e.id,visited:e.visited}))),[t,j,A]),[F,I]=(0,m.useState)(null),[L,R]=(0,m.useState)([]);return(0,m.useEffect)(()=>{if(C)return;if(t!==`all`){if(A.length===0){I(null);return}let e=!1;(0,m.startTransition)(()=>{R([])});let n=S[Number(t)];return f(A,n&&n.length===A.length-1?n:void 0).then(t=>{e||(0,m.startTransition)(()=>{I(t)})}),()=>{e=!0}}if(j.length===0){R([]),I(null);return}let e=!1;return I(null),Promise.all(j.map(async e=>{await new Promise(e=>setTimeout(e,0));let t=S[e.day],n=t&&t.length===e.attractions.length-1?t:void 0;return f(e.attractions,n)})).then(t=>{e||(0,m.startTransition)(()=>{R(t)})}),()=>{e=!0}},[P,S,C]),y?(0,h.jsx)(`div`,{className:`min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center`,children:(0,h.jsx)(`div`,{className:`animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600`})}):(0,h.jsxs)(`div`,{className:`min-h-screen bg-gray-50 dark:bg-gray-900 pb-20 md:pb-6`,children:[(0,h.jsx)(u,{title:`Timeline`,subtitle:`${M} - Visualize seu dia com rotas e clima`,filter:(0,h.jsx)(s,{hideGeneralOption:!0}),action:N?(0,h.jsxs)(`button`,{type:`button`,onClick:async()=>{if(N){D(!0);try{let{exportTimelineToPDF:e}=await n(async()=>{let{exportTimelineToPDF:e}=await import(`./exportTimelineToPDF-Cd-dNzo9.js`);return{exportTimelineToPDF:e}},__vite__mapDeps([10,1,2,3,4,5,6,7,8,9,11,12]));if(t===`all`){let t=(L.length===j.length?L:await Promise.all(j.map(e=>{let t=S[e.day],n=t&&t.length===e.attractions.length-1?t:void 0;return f(e.attractions,n)}))).filter(e=>e!=null);t.length>0?(e(t),w(`PDF exportado com sucesso!`)):T(`Nenhuma timeline gerada para exportar`)}else{let n=S[Number(t)],r=n&&n.length===A.length-1?n:void 0,i=F??await f(A,r);i?(e([i]),w(`PDF exportado com sucesso!`)):T(`Nenhuma timeline gerada para exportar`)}}catch(e){console.error(e),T(`Erro ao exportar PDF`)}finally{D(!1)}}},disabled:E,className:`flex items-center gap-2 px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 text-white text-sm font-medium transition-colors disabled:opacity-60 disabled:cursor-not-allowed`,title:`Exportar timeline em PDF`,children:[(0,h.jsx)(i,{className:`w-4 h-4`}),E?`Exportando…`:`Exportar PDF`]}):void 0}),(0,h.jsxs)(`main`,{className:`max-w-6xl mx-auto px-4 md:px-6 py-6 min-h-screen`,children:[!1,(t===`all`?j.length===0:A.length===0)?(0,h.jsxs)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-12 text-center`,children:[(0,h.jsx)(a,{className:`w-16 h-16 text-gray-400 mx-auto mb-4`}),(0,h.jsx)(`h3`,{className:`text-xl font-bold text-gray-900 dark:text-gray-100 mb-2`,children:t===`all`?`Nenhuma atração com coordenadas`:`Nenhuma atração para o Dia ${t}`}),(0,h.jsx)(`p`,{className:`text-gray-600 dark:text-gray-400 mb-4`,children:t===`all`?`Adicione coordenadas (lat/lng) às suas atrações para visualizar as timelines por dia`:`Adicione coordenadas (lat/lng) às suas atrações para visualizar a timeline`}),(0,h.jsx)(r,{to:`/attractions`,className:`inline-block px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors`,children:`Ir para Atrações`})]}):C?(0,h.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-8 text-center`,children:(0,h.jsx)(`p`,{className:`text-gray-500 dark:text-gray-400 text-sm`,children:`Carregando rotas em segundo plano...`})}):t===`all`?(0,h.jsx)(`div`,{className:`space-y-10`,children:(0,h.jsx)(m.Suspense,{fallback:(0,h.jsx)(`div`,{className:`space-y-6`,children:(0,h.jsx)(`div`,{className:`h-650 bg-gray-200 dark:bg-gray-700 animate-pulse rounded-2xl`})}),children:j.map((e,t)=>(0,h.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 min-h-[calc(100dvh-160px)]`,children:(0,h.jsx)(g,{timeline:L[t]??null,city:e.attractions[0]?.city,date:e.date,onToggleVisited:O})},e.day))})}):(0,h.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 min-h-[420px]`,children:(0,h.jsx)(m.Suspense,{fallback:(0,h.jsx)(`div`,{className:`h-40 bg-gray-200 dark:bg-gray-700 animate-pulse rounded-2xl`}),children:(0,h.jsx)(g,{timeline:F,city:A[0]?.city,date:A[0]?.date,onToggleVisited:O})})})]})]})}export{v as default};