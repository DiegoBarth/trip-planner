import{C as e,S as t,a as n,c as r,h as i}from"./google-login-button-CK2bO50y.js";import{S as a,W as o,Z as s,i as c}from"./ui-icons-BBIUuva6.js";import{a as l,n as u,o as d,s as f,t as p}from"./zod-BU_exWGf.js";import{J as m,N as h,P as g,T as _,V as v,Y as y,_ as b,k as x,m as S}from"./index-BT_MijvE.js";import{i as C,n as w,r as T,t as E}from"./validateWithToast-z2mPQ6lw.js";import{t as D}from"./DateField-BP8CCOyG.js";var O=e(),k=t();function A({onFileUploaded:e,currentFile:t,currentFileId:n,label:r=`Documento`,accept:i=`.pdf,.jpg,.jpeg,.png,.xls,.xlsx`,maxSizeMB:l=10}){let[u,d]=(0,O.useState)(!1),[f,p]=(0,O.useState)(!1),[m,h]=(0,O.useState)(null),g=async t=>{let n=t.target.files?.[0];if(!n)return;h(null);let r=l*1024*1024;if(n.size>r){h(`Arquivo muito grande. M√°ximo: ${l}MB`);return}if(![`application/pdf`,`image/jpeg`,`image/jpg`,`image/png`,`application/vnd.ms-excel`,`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`].includes(n.type)){h(`Tipo de arquivo n√£o suportado. Use PDF, JPG, PNG ou Excel.`);return}d(!0);try{let t=await v(n),r=await x(n.name,t,n.type);if(r.success&&r.fileUrl&&r.fileId)e(r.fileUrl,r.fileId),h(null);else throw Error(r.message||`Erro ao fazer upload`)}catch(e){console.error(`Upload error:`,e),h(`Erro ao fazer upload do arquivo. Tente novamente.`)}finally{d(!1),t.target.value=``}},v=e=>new Promise((t,n)=>{let r=new FileReader;r.readAsDataURL(e),r.onload=()=>{let e=r.result.split(`,`)[1];t(e)},r.onerror=e=>n(e)});return(0,k.jsxs)(`div`,{className:`space-y-2`,children:[(0,k.jsx)(`label`,{className:`block text-sm font-medium text-gray-700`,children:r}),t?(0,k.jsxs)(`div`,{className:`flex items-center gap-2 p-3 bg-blue-50 border-2 border-blue-200 rounded-lg`,children:[(0,k.jsx)(a,{className:`w-5 h-5 text-blue-600 flex-shrink-0`}),(0,k.jsx)(`a`,{href:t,target:`_blank`,rel:`noopener noreferrer`,className:`flex-1 text-sm text-blue-600 hover:underline truncate`,title:t,children:(e=>{if(!e)return``;if(e.includes(`drive.google.com`))return`Documento no Google Drive`;try{return new URL(e).pathname.split(`/`).pop()||`Documento anexado`}catch{return`Documento anexado`}})(t)}),(0,k.jsx)(`button`,{type:`button`,onClick:async()=>{if(n){p(!0);try{await _(n)}catch(e){console.error(`Error deleting file from Drive:`,e)}finally{p(!1)}}e(``,``),h(null)},disabled:f,className:`p-1 hover:bg-blue-100 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed`,title:`Remover arquivo`,children:f?(0,k.jsx)(o,{className:`w-4 h-4 text-blue-600 animate-spin`}):(0,k.jsx)(s,{className:`w-4 h-4 text-blue-600`})})]}):(0,k.jsxs)(`div`,{className:`relative`,children:[(0,k.jsx)(`input`,{type:`file`,autoComplete:`off`,onChange:g,disabled:u,className:`hidden`,id:`file-upload-${r}`,accept:i}),(0,k.jsx)(`label`,{htmlFor:`file-upload-${r}`,className:`
              flex items-center justify-center gap-2 w-full p-4 
              border-2 border-dashed rounded-lg cursor-pointer
              transition-all
              ${u?`border-blue-400 bg-blue-50 cursor-not-allowed`:`border-gray-300 hover:border-blue-400 hover:bg-blue-50`}
            `,children:u?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(o,{className:`w-5 h-5 text-blue-600 animate-spin`}),(0,k.jsx)(`span`,{className:`text-sm text-blue-600`,children:`Fazendo upload...`})]}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(c,{className:`w-5 h-5 text-gray-400`}),(0,k.jsx)(`span`,{className:`text-sm text-gray-600`,children:`Clique para anexar arquivo`})]})})]}),m&&(0,k.jsxs)(`p`,{className:`text-xs text-red-600 flex items-center gap-1`,children:[(0,k.jsx)(`span`,{children:`‚ö†Ô∏è`}),m]}),!m&&(0,k.jsxs)(`p`,{className:`text-xs text-gray-500`,children:[`PDF, JPG, PNG ou Excel ‚Ä¢ M√°ximo: `,l,`MB`]})]})}var j=u([`document`,`insurance`,`flight`,`train`,`bus`,`accommodation`,`transport-pass`,`activity`,`other`],{message:`O Tipo da reserva √© obrigat√≥rio.`}),M=u([`pending`,`confirmed`,`cancelled`,`completed`],{message:`O Status √© obrigat√≥rio.`}),N=u([`japan`,`south-korea`,`general`],{message:`O Pa√≠s √© obrigat√≥rio.`});const P=d({type:j,title:f().trim().min(1,`O T√≠tulo √© obrigat√≥rio.`),description:f().optional(),confirmationCode:f().optional(),date:p({message:`A Data √© obrigat√≥ria`}),endDate:p({message:`A Data Fim √© obrigat√≥ria`}),time:f().optional(),provider:f().trim().min(1,`O Provedor √© obrigat√≥rio.`),location:f().trim().min(1,`O Local √© obrigat√≥rio.`),bookingUrl:f().optional(),documentUrl:f().optional(),documentFileId:f().optional(),status:M,notes:f().optional(),country:N,attractionId:l().optional()});P.extend({id:l({message:`ID √© obrigat√≥rio.`})});function F({reservation:e,isOpen:t,onClose:a,onSave:o}){let s=m(),[c,l]=(0,O.useState)(!1),[u,d]=(0,O.useState)(``),[f,p]=(0,O.useState)(``),{register:x,handleSubmit:j,watch:M,setValue:N,reset:F,control:I}=C({defaultValues:{type:`activity`,title:``,description:``,confirmationCode:``,date:``,endDate:``,time:``,location:``,provider:``,bookingUrl:``,documentUrl:``,status:`pending`,notes:``,country:void 0,attractionId:void 0}}),L=M(),{country:R}=y(),{attractions:z}=b(R);return(0,O.useEffect)(()=>{if(t)if(e){let t=e.documentFileId||``;F({type:e.type,title:e.title,description:e.description||``,confirmationCode:e.confirmationCode||``,date:e.date?h(e.date):``,endDate:e.endDate?h(e.endDate):``,time:e.time||``,location:e.location||``,provider:e.provider||``,bookingUrl:e.bookingUrl||``,documentUrl:e.documentUrl||``,status:e.status,notes:e.notes||``,country:e.country,attractionId:e.attractionId}),d(t),p(t)}else F({type:`activity`,title:``,description:``,confirmationCode:``,date:``,endDate:``,time:``,location:``,provider:``,bookingUrl:``,documentUrl:``,status:`pending`,notes:``,country:void 0,attractionId:void 0}),d(``),p(``)},[t,e,F]),(0,k.jsx)(w,{isOpen:t,onClose:async()=>{if(u&&u!==f)try{await _(u)}catch(e){console.error(`Error cleaning up unsaved file:`,e)}a()},title:e?`Editar Reserva`:`Nova Reserva`,type:e?`edit`:`create`,onSave:j(async e=>{let t={type:e.type,title:e.title.trim(),description:e.description.trim()||void 0,confirmationCode:e.confirmationCode.trim()||void 0,date:e.date||void 0,endDate:e.endDate||void 0,time:e.time||void 0,location:e.location.trim()||``,provider:e.provider.trim()||``,bookingUrl:e.bookingUrl.trim()||void 0,documentUrl:e.documentUrl.trim()||void 0,documentFileId:u||void 0,status:e.status,notes:e.notes.trim()||void 0,country:e.country,attractionId:e.attractionId};if(E(t,P,s)){l(!0);try{await Promise.resolve(o(t)),a()}finally{l(!1)}}}),loading:c,loadingText:`Salvando...`,size:`lg`,children:(0,k.jsxs)(`div`,{className:`space-y-4`,children:[(0,k.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-3`,children:[(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-bold text-gray-900 dark:text-gray-100 mb-1.5`,children:`Tipo *`}),(0,k.jsx)(S,{value:i[L.type].label,onChange:e=>{let t=Object.entries(i).find(([t,n])=>n.label===e)?.[0];t&&N(`type`,t)},options:Object.values(i).map(e=>e.label)})]}),(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-bold text-gray-900 dark:text-gray-100 mb-1.5`,children:`Status *`}),(0,k.jsx)(S,{value:n[L.status].label,onChange:e=>{let t=Object.entries(n).find(([t,n])=>n.label===e)?.[0];t&&N(`status`,t)},options:Object.values(n).map(e=>e.label)})]})]}),(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-bold text-gray-900 dark:text-gray-100 mb-1.5`,children:`T√≠tulo *`}),(0,k.jsx)(`input`,{type:`text`,required:!0,autoComplete:`off`,...x(`title`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`Ex: Voo S√£o Paulo ‚Üí T√≥quio`})]}),(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-bold text-gray-900 dark:text-gray-100 mb-1.5`,children:`Descri√ß√£o`}),(0,k.jsx)(`input`,{type:`text`,autoComplete:`off`,...x(`description`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`Detalhes adicionais...`})]}),(0,k.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,k.jsx)(`h3`,{className:`text-sm font-bold text-gray-900 dark:text-gray-100 mb-2.5`,children:`üìÖ Datas e Hor√°rio`}),(0,k.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-3 gap-3`,children:[(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Data *`}),(0,k.jsx)(T,{name:`date`,control:I,render:({field:e})=>(0,k.jsx)(D,{value:e.value?v(e.value):void 0,onChange:t=>e.onChange(t?g(t):``)})})]}),(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Data Fim *`}),(0,k.jsx)(T,{name:`endDate`,control:I,render:({field:e})=>(0,k.jsx)(D,{value:e.value?v(e.value):void 0,onChange:t=>e.onChange(t?g(t):``)})})]}),(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Hor√°rio`}),(0,k.jsx)(`input`,{type:`time`,autoComplete:`off`,...x(`time`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none text-gray-900 dark:text-gray-100`})]})]})]}),(0,k.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,k.jsx)(`h3`,{className:`text-sm font-bold text-gray-900 dark:text-gray-100 mb-2.5`,children:`üè¢ Provedor e Confirma√ß√£o`}),(0,k.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-3`,children:[(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Provedor *`}),(0,k.jsx)(`input`,{type:`text`,autoComplete:`off`,...x(`provider`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`Ex: LATAM, Booki...`})]}),(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`C√≥digo`}),(0,k.jsx)(`input`,{type:`text`,autoComplete:`off`,...x(`confirmationCode`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100 font-mono uppercase`,placeholder:`ABC123`})]})]})]}),(0,k.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,k.jsx)(`h3`,{className:`text-sm font-bold text-gray-900 dark:text-gray-100 mb-2.5`,children:`üìç Localiza√ß√£o`}),(0,k.jsxs)(`div`,{className:`space-y-4`,children:[(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Local *`}),(0,k.jsx)(`input`,{type:`text`,autoComplete:`off`,...x(`location`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`Ex: Aeroporto de Narita`})]}),(0,k.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-3`,children:[(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Pa√≠s *`}),(0,k.jsx)(S,{value:L.country?`${r[L.country].flag} ${r[L.country].name}`:``,onChange:e=>{if(!e){N(`country`,void 0);return}let t=Object.entries(r).find(([t,n])=>`${n.flag} ${n.name}`===e)?.[0];t&&N(`country`,t)},options:[``,...Object.entries(r).map(([e,t])=>`${t.flag} ${t.name}`)].filter(Boolean),placeholder:`Selecione...`})]}),(0,k.jsxs)(`div`,{children:[(0,k.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:[`Vincular Atra√ß√£o `,(0,k.jsx)(`span`,{className:`text-xs text-gray-500`,children:`(opcional)`})]}),(0,k.jsx)(T,{name:`attractionId`,control:I,render:({field:e})=>(0,k.jsx)(S,{value:L.attractionId&&z.find(e=>e.id===L.attractionId)?.name||``,onChange:t=>{if(!t){e.onChange(void 0);return}let n=z.find(e=>e.name===t);n&&e.onChange(n.id)},options:[``,...z.map(e=>e.name)],placeholder:`Nenhuma...`})})]})]})]})]}),(0,k.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,k.jsx)(`h3`,{className:`text-sm font-bold text-gray-900 dark:text-gray-100 mb-2.5`,children:`üîó Links`}),(0,k.jsxs)(`div`,{children:[(0,k.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Link da Reserva`}),(0,k.jsx)(`input`,{type:`url`,autoComplete:`off`,...x(`bookingUrl`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`https://booking.com/...`})]})]}),(0,k.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,k.jsx)(`h3`,{className:`text-sm font-bold text-gray-900 dark:text-gray-100 mb-2.5`,children:`üìÑ Documento`}),(0,k.jsxs)(`div`,{className:`space-y-4`,children:[(0,k.jsx)(A,{label:`Comprovante ou documento`,currentFile:L.documentUrl,currentFileId:u,onFileUploaded:(e,t)=>{N(`documentUrl`,e),d(t)}}),(0,k.jsxs)(`div`,{className:`relative`,children:[(0,k.jsx)(`div`,{className:`absolute inset-0 flex items-center`,children:(0,k.jsx)(`div`,{className:`w-full border-t border-gray-200 dark:border-gray-700`})}),(0,k.jsx)(`div`,{className:`relative flex justify-center text-xs`,children:(0,k.jsx)(`span`,{className:`px-2 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400`,children:`ou cole um link`})})]}),(0,k.jsx)(`input`,{type:`url`,autoComplete:`off`,value:L.documentUrl,onChange:e=>N(`documentUrl`,e.target.value),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100 text-sm`,placeholder:`https://drive.google.com/...`})]})]}),(0,k.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,k.jsx)(`label`,{className:`block text-sm font-bold text-gray-900 dark:text-gray-100 mb-1.5`,children:`üìù Observa√ß√µes`}),(0,k.jsx)(`textarea`,{...x(`notes`),rows:3,autoComplete:`off`,className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100 resize-none`,placeholder:`Informa√ß√µes adicionais importantes...`})]})]})})}export{F as t};