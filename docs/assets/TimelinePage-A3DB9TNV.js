const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Timeline-TGTpQ8FR.js","assets/index-CIXHJ0H9.js","assets/router-BQVnTVu0.js","assets/google-login-button-CK2bO50y.js","assets/rolldown-runtime-CWU8vmCm.js","assets/react-query-BB-sDLdC.js","assets/ui-icons-BBIUuva6.js","assets/react-vendor-B0_zmQzX.js","assets/zod-BU_exWGf.js","assets/index-BCpq-9-m.css","assets/exportTimelineToPDF-o-wiZZZU.js","assets/jspdf.es.min-BCR6vzZc.js","assets/typeof-_tCs8JoZ.js"])))=>i.map(i=>d[i]);
import{C as e,S as t}from"./google-login-button-CK2bO50y.js";import"./react-vendor-B0_zmQzX.js";import{c as n,l as r,n as i}from"./router-BQVnTVu0.js";import"./react-query-BB-sDLdC.js";import{K as a,w as o}from"./ui-icons-BBIUuva6.js";import"./zod-BU_exWGf.js";import{J as s,Y as c,_ as l,p as u}from"./index-CIXHJ0H9.js";import{t as d}from"./PageHeader-TYuxau95.js";import{i as f,r as p,t as m}from"./useOSRMRoutesQuery-aSsQUU4n.js";var h=e(),g=t(),_=(0,h.lazy)(()=>r(()=>import(`./Timeline-TGTpQ8FR.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])));function v(e,t){if(e.length===0||t.length===0)return e;let n=e[0].city,r=t.find(e=>e.city===n);return!r?.lat||!r?.lng?e:[{id:-999,name:r.description,lat:r.lat,lng:r.lng,city:r.city,region:e[0].region,country:r.country,order:0,date:e[0].date,day:e[0].day,dayOfWeek:e[0].dayOfWeek,type:`other`,duration:0,couplePrice:0,priceInBRL:0,currency:e[0].currency,visited:!1,needsReservation:!1,openingTime:void 0,closingTime:void 0,imageUrl:void 0},...e]}function y(){let[e]=n(),{country:t,day:y,setDay:b}=c(),{attractions:x,isLoading:S,toggleVisited:C}=l(t);(0,h.useEffect)(()=>{let t=e.get(`day`);if(t){let e=Number(t);Number.isInteger(e)&&e>0&&b(e)}},[e,b]);let{accommodations:w}=f(),{segmentsByDay:T,isRoutesLoading:E}=m((0,h.useMemo)(()=>{let e={};return x.filter(e=>e.lat!=null&&e.lng!=null).forEach(t=>{e[t.day]||(e[t.day]=[]),e[t.day].push(t)}),e},[x]),w),{success:D,error:O}=s(),[k,A]=(0,h.useState)(!1),j=(0,h.useCallback)(async e=>{try{await C(e),D(`Status da atração atualizado`)}catch(e){O(`Erro ao atualizar atração`),console.error(e)}},[C,D,O]),M=(0,h.useMemo)(()=>x.filter(e=>e.lat&&e.lng),[x]),N=(0,h.useMemo)(()=>M.length===0||y===`all`?[]:v(M.filter(e=>e.day===y),w),[M,y,w]),P=(0,h.useMemo)(()=>{if(y!==`all`||M.length===0)return[];let e={};return M.forEach(t=>{e[t.day]||(e[t.day]=[]),e[t.day].push(t)}),Object.keys(e).map(Number).sort((e,t)=>e-t).map(t=>{let n=e[t],r=v(n,w);return{day:t,date:n[0].date,attractions:r}})},[y,M,w]),F=(0,h.useMemo)(()=>y===`all`?P.length===0?`Todos os dias`:`${P.length} ${P.length===1?`dia`:`dias`}`:N.length===0?``:`Dia ${y}`,[y,P.length,N.length]),I=y===`all`?P.length>0:N.length>0,L=(0,h.useMemo)(()=>y===`all`?JSON.stringify(P.map(e=>({day:e.day,ids:e.attractions.map(e=>({id:e.id,visited:e.visited}))}))):JSON.stringify(N.map(e=>({id:e.id,visited:e.visited}))),[y,P,N]),[R,z]=(0,h.useState)(null),[B,V]=(0,h.useState)([]);return(0,h.useEffect)(()=>{if(E)return;if(y!==`all`){if(N.length===0){z(null);return}let e=!1;(0,h.startTransition)(()=>{V([])});let t=T[Number(y)];return p(N,t&&t.length===N.length-1?t:void 0).then(t=>{e||(0,h.startTransition)(()=>{z(t)})}),()=>{e=!0}}if(P.length===0){V([]),z(null);return}let e=!1;return z(null),Promise.all(P.map(async e=>{await new Promise(e=>setTimeout(e,0));let t=T[e.day],n=t&&t.length===e.attractions.length-1?t:void 0;return p(e.attractions,n)})).then(t=>{e||(0,h.startTransition)(()=>{V(t)})}),()=>{e=!0}},[L,T,E]),S?(0,g.jsx)(`div`,{className:`min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center`,children:(0,g.jsx)(`div`,{className:`animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600`})}):(0,g.jsxs)(`div`,{className:`min-h-screen bg-gray-50 dark:bg-gray-900 pb-20 md:pb-6`,children:[(0,g.jsx)(d,{title:`Timeline`,subtitle:`${F} - Visualize seu dia com rotas e clima`,filter:(0,g.jsx)(u,{hideGeneralOption:!0}),action:I?(0,g.jsxs)(`button`,{type:`button`,onClick:async()=>{if(I){A(!0);try{let{exportTimelineToPDF:e}=await r(async()=>{let{exportTimelineToPDF:e}=await import(`./exportTimelineToPDF-o-wiZZZU.js`);return{exportTimelineToPDF:e}},__vite__mapDeps([10,1,2,3,4,5,6,7,8,9,11,12]));if(y===`all`){let t=(B.length===P.length?B:await Promise.all(P.map(e=>{let t=T[e.day],n=t&&t.length===e.attractions.length-1?t:void 0;return p(e.attractions,n)}))).filter(e=>e!=null);t.length>0?(e(t),D(`PDF exportado com sucesso!`)):O(`Nenhuma timeline gerada para exportar`)}else{let t=T[Number(y)],n=t&&t.length===N.length-1?t:void 0,r=R??await p(N,n);r?(e([r]),D(`PDF exportado com sucesso!`)):O(`Nenhuma timeline gerada para exportar`)}}catch(e){console.error(e),O(`Erro ao exportar PDF`)}finally{A(!1)}}},disabled:k,className:`flex items-center gap-2 px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 text-white text-sm font-medium transition-colors disabled:opacity-60 disabled:cursor-not-allowed`,title:`Exportar timeline em PDF`,children:[(0,g.jsx)(o,{className:`w-4 h-4`}),k?`Exportando…`:`Exportar PDF`]}):void 0}),(0,g.jsxs)(`main`,{className:`max-w-6xl mx-auto px-4 md:px-6 py-6 min-h-screen`,children:[!1,(y===`all`?P.length===0:N.length===0)?(0,g.jsxs)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-12 text-center`,children:[(0,g.jsx)(a,{className:`w-16 h-16 text-gray-400 mx-auto mb-4`}),(0,g.jsx)(`h3`,{className:`text-xl font-bold text-gray-900 dark:text-gray-100 mb-2`,children:y===`all`?`Nenhuma atração com coordenadas`:`Nenhuma atração para o Dia ${y}`}),(0,g.jsx)(`p`,{className:`text-gray-600 dark:text-gray-400 mb-4`,children:y===`all`?`Adicione coordenadas (lat/lng) às suas atrações para visualizar as timelines por dia`:`Adicione coordenadas (lat/lng) às suas atrações para visualizar a timeline`}),(0,g.jsx)(i,{to:`/attractions`,className:`inline-block px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors`,children:`Ir para Atrações`})]}):E?(0,g.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-8 text-center`,children:(0,g.jsx)(`p`,{className:`text-gray-500 dark:text-gray-400 text-sm`,children:`Carregando rotas em segundo plano...`})}):y===`all`?(0,g.jsx)(`div`,{className:`space-y-10`,children:(0,g.jsx)(h.Suspense,{fallback:(0,g.jsx)(`div`,{className:`space-y-6`,children:(0,g.jsx)(`div`,{className:`h-650 bg-gray-200 dark:bg-gray-700 animate-pulse rounded-2xl`})}),children:P.map((e,t)=>(0,g.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 min-h-[calc(100dvh-160px)]`,children:(0,g.jsx)(_,{timeline:B[t]??null,city:e.attractions[0]?.city,date:e.date,onToggleVisited:j})},e.day))})}):(0,g.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 min-h-[420px]`,children:(0,g.jsx)(h.Suspense,{fallback:(0,g.jsx)(`div`,{className:`h-40 bg-gray-200 dark:bg-gray-700 animate-pulse rounded-2xl`}),children:(0,g.jsx)(_,{timeline:R,city:N[0]?.city,date:N[0]?.date,onToggleVisited:j})})})]})]})}export{y as default};