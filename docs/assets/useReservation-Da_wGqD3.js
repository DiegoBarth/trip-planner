import{p as e}from"./google-login-button-CK2bO50y.js";import{i as t,o as n,t as r}from"./react-query-BB-sDLdC.js";import{C as i,D as a,E as o,H as s,M as c,S as l,T as u,V as d,b as f,w as p,x as m,y as h}from"./index-DpljZKJp.js";var g=[`reservations`];function _(){let _=n(),{data:v=[],isLoading:y,error:b}=t({queryKey:g,queryFn:o,staleTime:e}),x=r({mutationFn:e=>i(e),onSuccess:e=>{h(_,e)}}),S=r({mutationFn:async e=>{let t=v.find(t=>t.id===e.id);if(t?.documentFileId&&t.documentFileId!==e.documentFileId)try{await p(t.documentFileId)}catch(e){console.error(`Error deleting old file from Drive:`,e)}e.date=e.date?c(e.date):void 0,e.endDate=e.endDate?c(e.endDate):void 0;let n=await a(e);if(n.attractionId&&n.status)try{let e=[`japan`,`south-korea`,`general`],t=null,r=null;for(let i of e){let e=_.getQueryData([`attractions`,i]);if(e){let a=e.find(e=>e.id===n.attractionId);if(a){t=a,r=i;break}}}if(t&&r){let e;n.status===`confirmed`?e=`confirmed`:n.status===`pending`?e=`pending`:n.status===`cancelled`&&(e=`cancelled`),e&&(await s({...t,date:c(t.date),reservationStatus:e}),_.setQueryData([`attractions`,r],(n=[])=>n.map(n=>n.id===t.id?{...n,reservationStatus:e}:n)))}}catch(e){console.error(`Error syncing status with linked attraction:`,e)}return n},onSuccess:e=>{m(_,e)}}),C=r({mutationFn:async e=>{let t=v.find(t=>t.id===e);if(t?.documentFileId)try{await p(t.documentFileId)}catch(e){console.error(`Error deleting file from Drive:`,e)}if(t?.attractionId)try{await d(t.attractionId);for(let e of[`japan`,`south-korea`,`general`])if(_.getQueryData([`attractions`,e])?.some(e=>e.id===t.attractionId)){l(_,t.attractionId);break}}catch(e){console.error(`Error cascade deleting linked attraction:`,e)}return u(e)},onSuccess:(e,t)=>{f(_,t)}});return{reservations:v,isLoading:y,error:b,createReservation:x.mutateAsync,updateReservation:S.mutateAsync,deleteReservation:C.mutateAsync,isCreating:x.isPending,isUpdating:S.isPending,isDeleting:C.isPending}}export{_ as t};