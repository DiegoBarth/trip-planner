const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Timeline-BWTKnUSO.js","assets/index-rMeLVRfY.js","assets/router-BCc6NGaV.js","assets/google-login-button-BZ5FbxrR.js","assets/rolldown-runtime-CWU8vmCm.js","assets/react-query-D7qSFt80.js","assets/ui-icons-DZI1O9wh.js","assets/react-vendor-EEmDTsrY.js","assets/zod-BU_exWGf.js","assets/index-D1LwnVj6.css","assets/exportTimelineToPDF-Xih5KP_U.js","assets/jspdf.es.min-_OpYnJ-y.js","assets/typeof-_tCs8JoZ.js"])))=>i.map(i=>d[i]);
import{b as e,y as t}from"./google-login-button-BZ5FbxrR.js";import"./react-vendor-EEmDTsrY.js";import{n,s as r}from"./router-BCc6NGaV.js";import"./react-query-D7qSFt80.js";import{H as i,l as a}from"./ui-icons-DZI1O9wh.js";import"./zod-BU_exWGf.js";import{c as o,l as s,n as c,p as l}from"./index-rMeLVRfY.js";import"./useMediaQuery-mMPbHttp.js";import{t as u}from"./PageHeader-C3LD77XA.js";import{r as d,t as f}from"./useOSRMRoutesQuery-CgFd-O7H.js";var p=e(),m=t(),h=(0,p.lazy)(()=>r(()=>import(`./Timeline-BWTKnUSO.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])));function g(e,t){if(e.length===0||t.length===0)return e;let n=e[0].city,r=t.find(e=>e.city===n);return!r?.lat||!r?.lng?e:[{id:-999,name:r.description,lat:r.lat,lng:r.lng,city:r.city,region:e[0].region,country:r.country,order:0,date:e[0].date,day:e[0].day,dayOfWeek:e[0].dayOfWeek,type:`other`,duration:0,couplePrice:0,priceInBRL:0,currency:e[0].currency,visited:!1,needsReservation:!1,openingTime:void 0,closingTime:void 0,imageUrl:void 0},...e]}function _(){let{country:e,day:t,accommodations:_,attractions:v,isReady:y}=s(),{toggleVisited:b}=l(e),{segmentsByDay:x,isRoutesLoading:S}=f((0,p.useMemo)(()=>{let e={};return v.filter(e=>e.lat!=null&&e.lng!=null).forEach(t=>{e[t.day]||(e[t.day]=[]),e[t.day].push(t)}),e},[v]),_),{success:C,error:w}=o(),[T,E]=(0,p.useState)(!1),D=(0,p.useCallback)(async e=>{try{await b(e),C(`Status da atração atualizado`)}catch(e){w(`Erro ao atualizar atração`),console.error(e)}},[b,C,w]),O=(0,p.useMemo)(()=>v.filter(e=>e.lat&&e.lng),[v]),k=(0,p.useMemo)(()=>O.length===0||t===`all`?[]:g(O.filter(e=>e.day===t),_),[O,t,_]),A=(0,p.useMemo)(()=>{if(t!==`all`||O.length===0)return[];let e={};return O.forEach(t=>{e[t.day]||(e[t.day]=[]),e[t.day].push(t)}),Object.keys(e).map(Number).sort((e,t)=>e-t).map(t=>{let n=e[t],r=g(n,_);return{day:t,date:n[0].date,attractions:r}})},[t,O,_]),j=(0,p.useMemo)(()=>t===`all`?A.length===0?`Todos os dias`:`${A.length} ${A.length===1?`dia`:`dias`}`:k.length===0?``:`Dia ${t}`,[t,A.length,k.length]),M=t===`all`?A.length>0:k.length>0,N=(0,p.useMemo)(()=>t===`all`?JSON.stringify(A.map(e=>({day:e.day,ids:e.attractions.map(e=>({id:e.id,visited:e.visited}))}))):JSON.stringify(k.map(e=>({id:e.id,visited:e.visited}))),[t,A,k]),[P,F]=(0,p.useState)(null),[I,L]=(0,p.useState)([]);return(0,p.useEffect)(()=>{if(S)return;if(t!==`all`){if(k.length===0){F(null);return}let e=!1;(0,p.startTransition)(()=>{L([])});let n=x[Number(t)];return d(k,n&&n.length===k.length-1?n:void 0).then(t=>{e||(0,p.startTransition)(()=>{F(t)})}),()=>{e=!0}}if(A.length===0){L([]),F(null);return}let e=!1;return F(null),Promise.all(A.map(async e=>{await new Promise(e=>setTimeout(e,0));let t=x[e.day],n=t&&t.length===e.attractions.length-1?t:void 0;return d(e.attractions,n)})).then(t=>{e||(0,p.startTransition)(()=>{L(t)})}),()=>{e=!0}},[N,x,S]),y?(0,m.jsxs)(`div`,{className:`min-h-screen bg-gray-50 dark:bg-gray-900 pb-20 md:pb-6`,children:[(0,m.jsx)(u,{title:`Timeline`,subtitle:`${j} - Visualize seu dia com rotas e clima`,filter:(0,m.jsx)(c,{hideGeneralOption:!0}),action:M?(0,m.jsxs)(`button`,{type:`button`,onClick:async()=>{if(M){E(!0);try{let{exportTimelineToPDF:e}=await r(async()=>{let{exportTimelineToPDF:e}=await import(`./exportTimelineToPDF-Xih5KP_U.js`);return{exportTimelineToPDF:e}},__vite__mapDeps([10,1,2,3,4,5,6,7,8,9,11,12]));if(t===`all`){let t=(I.length===A.length?I:await Promise.all(A.map(e=>{let t=x[e.day],n=t&&t.length===e.attractions.length-1?t:void 0;return d(e.attractions,n)}))).filter(e=>e!=null);t.length>0?(e(t),C(`PDF exportado com sucesso!`)):w(`Nenhuma timeline gerada para exportar`)}else{let n=x[Number(t)],r=n&&n.length===k.length-1?n:void 0,i=P??await d(k,r);i?(e([i]),C(`PDF exportado com sucesso!`)):w(`Nenhuma timeline gerada para exportar`)}}catch(e){console.error(e),w(`Erro ao exportar PDF`)}finally{E(!1)}}},disabled:T,className:`flex items-center gap-2 px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 text-white text-sm font-medium transition-colors disabled:opacity-60 disabled:cursor-not-allowed`,title:`Exportar timeline em PDF`,children:[(0,m.jsx)(a,{className:`w-4 h-4`}),T?`Exportando…`:`Exportar PDF`]}):void 0}),(0,m.jsxs)(`main`,{className:`max-w-6xl mx-auto px-4 md:px-6 py-6 min-h-screen`,children:[!1,(t===`all`?A.length===0:k.length===0)?(0,m.jsxs)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-12 text-center`,children:[(0,m.jsx)(i,{className:`w-16 h-16 text-gray-400 mx-auto mb-4`}),(0,m.jsx)(`h3`,{className:`text-xl font-bold text-gray-900 dark:text-gray-100 mb-2`,children:t===`all`?`Nenhuma atração com coordenadas`:`Nenhuma atração para o Dia ${t}`}),(0,m.jsx)(`p`,{className:`text-gray-600 dark:text-gray-400 mb-4`,children:t===`all`?`Adicione coordenadas (lat/lng) às suas atrações para visualizar as timelines por dia`:`Adicione coordenadas (lat/lng) às suas atrações para visualizar a timeline`}),(0,m.jsx)(n,{to:`/attractions`,className:`inline-block px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors`,children:`Ir para Atrações`})]}):S?(0,m.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-8 text-center`,children:(0,m.jsx)(`p`,{className:`text-gray-500 dark:text-gray-400 text-sm`,children:`Carregando rotas em segundo plano...`})}):t===`all`?(0,m.jsx)(`div`,{className:`space-y-10`,children:(0,m.jsx)(p.Suspense,{fallback:(0,m.jsx)(`div`,{className:`space-y-6`,children:(0,m.jsx)(`div`,{className:`h-650 bg-gray-200 dark:bg-gray-700 animate-pulse rounded-2xl`})}),children:A.map((e,t)=>(0,m.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 min-h-[calc(100dvh-160px)]`,children:(0,m.jsx)(h,{timeline:I[t]??null,city:e.attractions[0]?.city,date:e.date,onToggleVisited:D})},e.day))})}):(0,m.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 min-h-[420px]`,children:(0,m.jsx)(p.Suspense,{fallback:(0,m.jsx)(`div`,{className:`h-40 bg-gray-200 dark:bg-gray-700 animate-pulse rounded-2xl`}),children:(0,m.jsx)(h,{timeline:P,city:k[0]?.city,date:k[0]?.date,onToggleVisited:D})})})]})]}):(0,m.jsx)(`div`,{className:`min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center`,children:(0,m.jsx)(`div`,{className:`animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600`})})}export{_ as default};