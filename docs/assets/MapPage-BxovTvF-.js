import{i as e}from"./rolldown-runtime-CWU8vmCm.js";import{p as t}from"./dnd-kit-DVJe_fUm.js";import{t as n}from"./react-ClFNaAWa.js";import{a as r}from"./router-BfVF4rnG.js";import"./lucide-CpCSl3L4.js";import"./react-query-DJIZh4EV.js";import"./recharts-CxBv7Za6.js";import{r as i}from"./index-5C2ahvEh.js";import{t as a}from"./AttractionCard-BgTtsFC3.js";import"./useMediaQuery-VaZrTpFH.js";import"./CustomSelect-B5V8917S.js";import"./FilterSheetContext-DH1cdI4W.js";import{t as o}from"./PageHeader-D2v6m0T7.js";import{t as s}from"./CountryFilter-ydfLnIhx.js";import{a as c,i as l,n as u,o as d,r as f,s as p,t as m}from"./leaflet-DYzjVc5L.js";import{n as h,t as g}from"./useOSRMRoutesQuery-Digdarcw.js";var _=t(),v=e(p(),1);function y({attractions:e}){let t=d();return(0,_.useEffect)(()=>{if(!e.length)return;let n=e.filter(e=>typeof e.lat==`number`&&typeof e.lng==`number`);if(n.length>0){let e=v.default.latLngBounds(n.map(e=>[e.lat,e.lng]));t.fitBounds(e,{padding:[50,50]})}},[e,t]),null}var b=e(p(),1);function x(e,t=`attraction`,n){let r=!1;n&&(r=!!n.closedDays&&!!n.dayOfWeek&&n.closedDays.split(`,`).map(e=>e.trim()).includes(n.dayOfWeek));let i=e;t===`accommodation`&&(i=`#111827`),(t===`closed`||r)&&(i=`#ef4444`);let a=t===`accommodation`?`<text x="12" y="14" text-anchor="middle" font-size="10" fill="white">üè†</text>`:`<circle cx="12" cy="10" r="3" fill="white"></circle>`;return b.default.divIcon({html:`
      <div style="position: relative;">
        <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" viewBox="0 0 24 24"
          fill="${i}" stroke="white" stroke-width="2">
          <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
          ${a}
        </svg>
      </div>
    `,className:`custom-marker-icon`,iconSize:[42,42],iconAnchor:[21,42]})}var S=e(p(),1);m();var C=S.default;function w({positions:e,pathOptions:t}){let n=d();return(0,_.useEffect)(()=>{if(!e||e.length<2)return;let r=t.color??`#3388ff`,i=t.weight??5,a=t.opacity??.6,o=S.default.polyline(e,{color:r,weight:i,opacity:a}).addTo(n),s=C.polylineDecorator(e,{patterns:[{offset:0,repeat:80,symbol:C.Symbol.arrowHead({pixelSize:10,polygon:!0,pathOptions:{color:r,weight:1,opacity:a,fillOpacity:.8}})}]}).addTo(n);return()=>{n.removeLayer(o),n.removeLayer(s)}},[n,(0,_.useMemo)(()=>JSON.stringify(e),[e]),t.color,t.weight,t.opacity]),null}var T=n(),E=`#16a34a`;function D({groupedByDay:e,routes:t,accommodations:n,getColor:r,highlightAttractionId:i}){return(0,T.jsxs)(T.Fragment,{children:[n.map(e=>{let t=`https://www.google.com/maps?q=${e.lat},${e.lng}`;return(0,T.jsx)(l,{position:[e.lat,e.lng],icon:x(`#111827`,`accommodation`),children:(0,T.jsx)(f,{children:(0,T.jsxs)(`div`,{className:`p-2 space-y-2`,children:[(0,T.jsx)(`h3`,{className:`font-bold`,children:e.description}),(0,T.jsx)(`p`,{className:`text-sm`,children:e.address}),(0,T.jsx)(`br`,{}),(0,T.jsx)(`a`,{href:t,target:`_blank`,rel:`noopener noreferrer`,className:`text-blue-600 text-sm underline`,children:`Abrir no Google Maps`})]})})},`acc-${e.id}`)}),Object.entries(e).map(([e,n])=>{let o=Number(e);return(0,T.jsxs)(`div`,{children:[t[o]&&(0,T.jsx)(w,{positions:t[o],pathOptions:{color:r(o),weight:5,opacity:.6}}),n.map(e=>{let t=i!=null&&e.id===i;return(0,T.jsx)(l,{position:[e.lat,e.lng],icon:x(t?E:r(e.day),`attraction`,e),children:(0,T.jsx)(f,{maxWidth:300,minWidth:280,className:`custom-attraction-popup`,children:(0,T.jsx)(a,{attraction:e,onCheckVisited:()=>{}})})},e.id)})]},e)})]})}var O=[`#2563eb`,`#16a34a`,`#9333ea`,`#ea580c`,`#dc2626`,`#0891b2`];function k(e){return O[(e-1)%O.length]}function A(){let{attractions:e,accommodations:t,day:n}=i(),a=r(),o=(0,_.useMemo)(()=>e.filter(h),[e]),s=(0,_.useMemo)(()=>n===`all`?o:o.filter(e=>e.day===Number(n)),[o,n]),l=(0,_.useMemo)(()=>{let e={};return s.forEach(t=>{e[t.day]||(e[t.day]=[]),e[t.day].push(t)}),e},[s]),d=(0,_.useMemo)(()=>{if(!t||t.length===0)return[];if(n===`all`)return t;if(s.length===0)return[];let e=[...s].sort((e,t)=>e.order-t.order)[0]?.city?.trim().toLowerCase();return e?t.filter(t=>t.city?.trim().toLowerCase()===e):t},[t,n,s]),{routes:f}=g(l,d),p=(0,_.useMemo)(()=>[...s].sort((e,t)=>e.order-t.order).find(e=>e.id!==-999&&!e.visited)?.id??null,[s]),m=(0,_.useMemo)(()=>{if(d.length===0)return s;let e=new Set(s.map(e=>e.id)),t=d.filter(t=>!e.has(t.id));return[...s,...t]},[s,d]);return(0,T.jsx)(`div`,{className:`h-[calc(100vh-186px)] md:h-[calc(100vh-147px-4rem)]`,children:(0,T.jsxs)(c,{className:`h-full w-full`,zoom:13,scrollWheelZoom:!0,children:[(0,T.jsx)(u,{attribution:`¬© OpenStreetMap`,url:`https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png`}),(0,T.jsx)(y,{attractions:m}),(0,T.jsx)(D,{groupedByDay:l,routes:f,accommodations:d,getColor:k,highlightAttractionId:p})]},a.pathname)})}function j(){return(0,T.jsxs)(`div`,{className:`min-h-screen bg-gray-50 dark:bg-gray-900 pb-20 md:pb-6 flex flex-col`,children:[(0,T.jsx)(o,{title:`Mapa`,subtitle:`Visualize suas atra√ß√µes no mapa`,filter:(0,T.jsx)(s,{hideGeneralOption:!0})}),(0,T.jsx)(`main`,{className:`flex-1`,children:(0,T.jsx)(A,{})})]})}export{j as default};