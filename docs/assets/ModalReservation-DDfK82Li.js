import{a as e,b as t,c as n,m as r,y as i}from"./google-login-button-BZ5FbxrR.js";import{B as a,c as o,l as s,q as c}from"./ui-icons-Co5DzGlV.js";import{a as l,n as u,o as d,s as f,t as p}from"./zod-BU_exWGf.js";import{S as m,_ as h,c as g,g as _,k as v,l as y,r as b,x}from"./index-CienHaZV.js";import{i as S,n as C,r as w,t as T}from"./validateWithToast-2IIBjub3.js";import{t as E}from"./DateField-wLBBZmga.js";var D=t(),O=i();function k({onFileUploaded:e,currentFile:t,currentFileId:n,label:r=`Documento`,accept:i=`.pdf,.jpg,.jpeg,.png,.xls,.xlsx`,maxSizeMB:l=10}){let[u,d]=(0,D.useState)(!1),[f,p]=(0,D.useState)(!1),[m,g]=(0,D.useState)(null),v=async t=>{let n=t.target.files?.[0];if(!n)return;g(null);let r=l*1024*1024;if(n.size>r){g(`Arquivo muito grande. M√°ximo: ${l}MB`);return}if(![`application/pdf`,`image/jpeg`,`image/jpg`,`image/png`,`application/vnd.ms-excel`,`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`].includes(n.type)){g(`Tipo de arquivo n√£o suportado. Use PDF, JPG, PNG ou Excel.`);return}d(!0);try{let t=await y(n),r=await h(n.name,t,n.type);if(r.success&&r.fileUrl&&r.fileId)e(r.fileUrl,r.fileId),g(null);else throw Error(r.message||`Erro ao fazer upload`)}catch(e){console.error(`Upload error:`,e),g(`Erro ao fazer upload do arquivo. Tente novamente.`)}finally{d(!1),t.target.value=``}},y=e=>new Promise((t,n)=>{let r=new FileReader;r.readAsDataURL(e),r.onload=()=>{let e=r.result.split(`,`)[1];t(e)},r.onerror=e=>n(e)});return(0,O.jsxs)(`div`,{className:`space-y-2`,children:[(0,O.jsx)(`label`,{className:`block text-sm font-medium text-gray-700`,children:r}),t?(0,O.jsxs)(`div`,{className:`flex items-center gap-2 p-3 bg-blue-50 border-2 border-blue-200 rounded-lg`,children:[(0,O.jsx)(o,{className:`w-5 h-5 text-blue-600 flex-shrink-0`}),(0,O.jsx)(`a`,{href:t,target:`_blank`,rel:`noopener noreferrer`,className:`flex-1 text-sm text-blue-600 hover:underline truncate`,title:t,children:(e=>{if(!e)return``;if(e.includes(`drive.google.com`))return`Documento no Google Drive`;try{return new URL(e).pathname.split(`/`).pop()||`Documento anexado`}catch{return`Documento anexado`}})(t)}),(0,O.jsx)(`button`,{type:`button`,onClick:async()=>{if(n){p(!0);try{await _(n)}catch(e){console.error(`Error deleting file from Drive:`,e)}finally{p(!1)}}e(``,``),g(null)},disabled:f,className:`p-1 hover:bg-blue-100 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed`,title:`Remover arquivo`,children:f?(0,O.jsx)(a,{className:`w-4 h-4 text-blue-600 animate-spin`}):(0,O.jsx)(c,{className:`w-4 h-4 text-blue-600`})})]}):(0,O.jsxs)(`div`,{className:`relative`,children:[(0,O.jsx)(`input`,{type:`file`,autoComplete:`off`,onChange:v,disabled:u,className:`hidden`,id:`file-upload-${r}`,accept:i}),(0,O.jsx)(`label`,{htmlFor:`file-upload-${r}`,className:`
              flex items-center justify-center gap-2 w-full p-4 
              border-2 border-dashed rounded-lg cursor-pointer
              transition-all
              ${u?`border-blue-400 bg-blue-50 cursor-not-allowed`:`border-gray-300 hover:border-blue-400 hover:bg-blue-50`}
            `,children:u?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(a,{className:`w-5 h-5 text-blue-600 animate-spin`}),(0,O.jsx)(`span`,{className:`text-sm text-blue-600`,children:`Fazendo upload...`})]}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(s,{className:`w-5 h-5 text-gray-400`}),(0,O.jsx)(`span`,{className:`text-sm text-gray-600`,children:`Clique para anexar arquivo`})]})})]}),m&&(0,O.jsxs)(`p`,{className:`text-xs text-red-600 flex items-center gap-1`,children:[(0,O.jsx)(`span`,{children:`‚ö†Ô∏è`}),m]}),!m&&(0,O.jsxs)(`p`,{className:`text-xs text-gray-500`,children:[`PDF, JPG, PNG ou Excel ‚Ä¢ M√°ximo: `,l,`MB`]})]})}var A=u([`document`,`insurance`,`flight`,`train`,`bus`,`accommodation`,`transport-pass`,`activity`,`other`],{message:`O Tipo da reserva √© obrigat√≥rio.`}),j=u([`pending`,`confirmed`,`cancelled`,`completed`],{message:`O Status √© obrigat√≥rio.`}),M=u([`japan`,`south-korea`,`general`],{message:`O Pa√≠s √© obrigat√≥rio.`});const N=d({type:A,title:f().trim().min(1,`O T√≠tulo √© obrigat√≥rio.`),description:f().optional(),confirmationCode:f().optional(),date:p({message:`A Data √© obrigat√≥ria`}),endDate:p({message:`A Data Fim √© obrigat√≥ria`}),time:f().optional(),provider:f().trim().min(1,`O Provedor √© obrigat√≥rio.`),location:f().trim().min(1,`O Local √© obrigat√≥rio.`),bookingUrl:f().optional(),documentUrl:f().optional(),documentFileId:f().optional(),status:j,notes:f().optional(),country:M,attractionId:l().optional()});N.extend({id:l({message:`ID √© obrigat√≥rio.`})});function P({reservation:t,isOpen:i,onClose:a,onSave:o}){let s=g(),[c,l]=(0,D.useState)(!1),[u,d]=(0,D.useState)(``),[f,p]=(0,D.useState)(``),{register:h,handleSubmit:A,watch:j,setValue:M,reset:P,control:F}=S({defaultValues:{type:`activity`,title:``,description:``,confirmationCode:``,date:``,endDate:``,time:``,location:``,provider:``,bookingUrl:``,documentUrl:``,status:`pending`,notes:``,country:void 0,attractionId:void 0}}),I=j(),{attractions:L}=y();return(0,D.useEffect)(()=>{if(i)if(t){let e=t.documentFileId||``;P({type:t.type,title:t.title,description:t.description||``,confirmationCode:t.confirmationCode||``,date:t.date?x(t.date):``,endDate:t.endDate?x(t.endDate):``,time:t.time||``,location:t.location||``,provider:t.provider||``,bookingUrl:t.bookingUrl||``,documentUrl:t.documentUrl||``,status:t.status,notes:t.notes||``,country:t.country,attractionId:t.attractionId}),d(e),p(e)}else P({type:`activity`,title:``,description:``,confirmationCode:``,date:``,endDate:``,time:``,location:``,provider:``,bookingUrl:``,documentUrl:``,status:`pending`,notes:``,country:void 0,attractionId:void 0}),d(``),p(``)},[i,t,P]),(0,O.jsx)(C,{isOpen:i,onClose:async()=>{if(u&&u!==f)try{await _(u)}catch(e){console.error(`Error cleaning up unsaved file:`,e)}a()},title:t?`Editar Reserva`:`Nova Reserva`,type:t?`edit`:`create`,onSave:A(async e=>{let t={type:e.type,title:e.title.trim(),description:e.description.trim()||void 0,confirmationCode:e.confirmationCode.trim()||void 0,date:e.date||void 0,endDate:e.endDate||void 0,time:e.time||void 0,location:e.location.trim()||``,provider:e.provider.trim()||``,bookingUrl:e.bookingUrl.trim()||void 0,documentUrl:e.documentUrl.trim()||void 0,documentFileId:u||void 0,status:e.status,notes:e.notes.trim()||void 0,country:e.country,attractionId:e.attractionId};if(T(t,N,s)){l(!0);try{await Promise.resolve(o(t)),a()}finally{l(!1)}}}),loading:c,loadingText:`Salvando...`,size:`lg`,children:(0,O.jsxs)(`div`,{className:`space-y-4`,children:[(0,O.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-3`,children:[(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-bold text-gray-900 dark:text-gray-100 mb-1.5`,children:`Tipo *`}),(0,O.jsx)(b,{value:r[I.type].label,onChange:e=>{let t=Object.entries(r).find(([t,n])=>n.label===e)?.[0];t&&M(`type`,t)},options:Object.values(r).map(e=>e.label)})]}),(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-bold text-gray-900 dark:text-gray-100 mb-1.5`,children:`Status *`}),(0,O.jsx)(b,{value:e[I.status].label,onChange:t=>{let n=Object.entries(e).find(([e,n])=>n.label===t)?.[0];n&&M(`status`,n)},options:Object.values(e).map(e=>e.label)})]})]}),(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-bold text-gray-900 dark:text-gray-100 mb-1.5`,children:`T√≠tulo *`}),(0,O.jsx)(`input`,{type:`text`,required:!0,autoComplete:`off`,...h(`title`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`Ex: Voo S√£o Paulo ‚Üí T√≥quio`})]}),(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-bold text-gray-900 dark:text-gray-100 mb-1.5`,children:`Descri√ß√£o`}),(0,O.jsx)(`input`,{type:`text`,autoComplete:`off`,...h(`description`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`Detalhes adicionais...`})]}),(0,O.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,O.jsx)(`h3`,{className:`text-sm font-bold text-gray-900 dark:text-gray-100 mb-2.5`,children:`üìÖ Datas e Hor√°rio`}),(0,O.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-3 gap-3`,children:[(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Data *`}),(0,O.jsx)(w,{name:`date`,control:F,render:({field:e})=>(0,O.jsx)(E,{value:e.value?v(e.value):void 0,onChange:t=>e.onChange(t?m(t):``)})})]}),(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Data Fim *`}),(0,O.jsx)(w,{name:`endDate`,control:F,render:({field:e})=>(0,O.jsx)(E,{value:e.value?v(e.value):void 0,onChange:t=>e.onChange(t?m(t):``)})})]}),(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Hor√°rio`}),(0,O.jsx)(`input`,{type:`time`,autoComplete:`off`,...h(`time`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none text-gray-900 dark:text-gray-100`})]})]})]}),(0,O.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,O.jsx)(`h3`,{className:`text-sm font-bold text-gray-900 dark:text-gray-100 mb-2.5`,children:`üè¢ Provedor e Confirma√ß√£o`}),(0,O.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-3`,children:[(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Provedor *`}),(0,O.jsx)(`input`,{type:`text`,autoComplete:`off`,...h(`provider`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`Ex: LATAM, Booki...`})]}),(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`C√≥digo`}),(0,O.jsx)(`input`,{type:`text`,autoComplete:`off`,...h(`confirmationCode`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100 font-mono uppercase`,placeholder:`ABC123`})]})]})]}),(0,O.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,O.jsx)(`h3`,{className:`text-sm font-bold text-gray-900 dark:text-gray-100 mb-2.5`,children:`üìç Localiza√ß√£o`}),(0,O.jsxs)(`div`,{className:`space-y-4`,children:[(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Local *`}),(0,O.jsx)(`input`,{type:`text`,autoComplete:`off`,...h(`location`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`Ex: Aeroporto de Narita`})]}),(0,O.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-3`,children:[(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Pa√≠s *`}),(0,O.jsx)(b,{value:I.country?`${n[I.country].flag} ${n[I.country].name}`:``,onChange:e=>{if(!e){M(`country`,void 0);return}let t=Object.entries(n).find(([t,n])=>`${n.flag} ${n.name}`===e)?.[0];t&&M(`country`,t)},options:[``,...Object.entries(n).map(([e,t])=>`${t.flag} ${t.name}`)].filter(Boolean),placeholder:`Selecione...`})]}),(0,O.jsxs)(`div`,{children:[(0,O.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:[`Vincular Atra√ß√£o `,(0,O.jsx)(`span`,{className:`text-xs text-gray-500`,children:`(opcional)`})]}),(0,O.jsx)(w,{name:`attractionId`,control:F,render:({field:e})=>(0,O.jsx)(b,{value:I.attractionId&&L.find(e=>e.id===I.attractionId)?.name||``,onChange:t=>{if(!t){e.onChange(void 0);return}let n=L.find(e=>e.name===t);n&&e.onChange(n.id)},options:[``,...L.map(e=>e.name)],placeholder:`Nenhuma...`})})]})]})]})]}),(0,O.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,O.jsx)(`h3`,{className:`text-sm font-bold text-gray-900 dark:text-gray-100 mb-2.5`,children:`üîó Links`}),(0,O.jsxs)(`div`,{children:[(0,O.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Link da Reserva`}),(0,O.jsx)(`input`,{type:`url`,autoComplete:`off`,...h(`bookingUrl`),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`https://booking.com/...`})]})]}),(0,O.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,O.jsx)(`h3`,{className:`text-sm font-bold text-gray-900 dark:text-gray-100 mb-2.5`,children:`üìÑ Documento`}),(0,O.jsxs)(`div`,{className:`space-y-4`,children:[(0,O.jsx)(k,{label:`Comprovante ou documento`,currentFile:I.documentUrl,currentFileId:u,onFileUploaded:(e,t)=>{M(`documentUrl`,e),d(t)}}),(0,O.jsxs)(`div`,{className:`relative`,children:[(0,O.jsx)(`div`,{className:`absolute inset-0 flex items-center`,children:(0,O.jsx)(`div`,{className:`w-full border-t border-gray-200 dark:border-gray-700`})}),(0,O.jsx)(`div`,{className:`relative flex justify-center text-xs`,children:(0,O.jsx)(`span`,{className:`px-2 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400`,children:`ou cole um link`})})]}),(0,O.jsx)(`input`,{type:`url`,autoComplete:`off`,value:I.documentUrl,onChange:e=>M(`documentUrl`,e.target.value),className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100 text-sm`,placeholder:`https://drive.google.com/...`})]})]}),(0,O.jsxs)(`div`,{className:`pt-4 border-t border-gray-200 dark:border-gray-700`,children:[(0,O.jsx)(`label`,{className:`block text-sm font-bold text-gray-900 dark:text-gray-100 mb-1.5`,children:`üìù Observa√ß√µes`}),(0,O.jsx)(`textarea`,{...h(`notes`),rows:3,autoComplete:`off`,className:`w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100 resize-none`,placeholder:`Informa√ß√µes adicionais importantes...`})]})]})})}export{P as t};