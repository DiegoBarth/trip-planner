import{p as e}from"./dnd-kit-DVJe_fUm.js";import{t}from"./react-ClFNaAWa.js";import{n}from"./router-BfVF4rnG.js";import{F as r,I as i,J as a,K as o,M as s,V as c,X as l,a as u,n as d,o as f,q as p,u as m,v as h,x as g,z as _}from"./lucide-DbbAxtoz.js";import{i as v}from"./react-query-NYR1e9Ja.js";import"./recharts-CxBv7Za6.js";import{D as y,I as b,O as x,_ as S,b as C,h as w,r as T,s as ee}from"./index-zXmCOto1.js";import"./typeof-l7GKHB57.js";import"./useMediaQuery-ByOPuZXL.js";import"./CustomSelect-x9Dmt6h9.js";import"./FilterSheetContext-CEDTtV_9.js";import{t as E}from"./PageHeader-DCY9FEj3.js";import{t as D}from"./CountryFilter-CGXyVXEd.js";import{t as O}from"./jspdf.es.min-D9hgQUq5.js";import{r as k,t as A}from"./useOSRMRoutesQuery-BNZ1Uo2q.js";var j=e(),M=t();function N(e,t){let n=`https://www.google.com/maps/search/?api=1&query=${e},${t}`;window.open(n,`_blank`)}function P({attraction:e,arrivalTime:t,departureTime:n,duration:r,conflicts:o,onToggleVisited:s}){let c=x[e.type],l=o.some(e=>e.severity===`error`),d=o.some(e=>e.severity===`warning`),f=e.visited,p=e.id===-999,m=e.lat&&e.lng;return(0,M.jsxs)(`div`,{className:`relative`,children:[(0,M.jsx)(`div`,{className:`
          absolute left-0 top-6 w-3 h-3 md:w-3.5 md:h-3.5 rounded-full border-2 border-white shadow z-20 -translate-x-1/2
          ${f?`bg-emerald-500`:`bg-slate-400`}
        `}),(0,M.jsxs)(`div`,{className:`
          relative ml-4 md:ml-6 rounded-2xl shadow-xl overflow-hidden transition-all border-l-4
          ${l?`border-l-red-500`:``}
          ${d&&!l?`border-l-amber-500`:``}
          ${f&&!l&&!d?`border-l-emerald-500`:``}
          ${!l&&!d&&!f?`border-l-slate-400`:``}
          ${f?`opacity-95`:``}
        `,children:[(0,M.jsx)(`div`,{className:`absolute inset-0 bg-cover bg-center`,style:{backgroundImage:e.thumbnailUrl||e.imageUrl?`url(${e.thumbnailUrl||e.imageUrl})`:void 0}}),(0,M.jsx)(`div`,{className:`absolute inset-0 bg-gradient-to-t from-black/90 via-black/60 to-black/50`}),(0,M.jsxs)(`div`,{className:`relative z-10 p-4 text-white`,children:[(0,M.jsxs)(`div`,{className:`flex items-center gap-2 mb-3 pb-2 border-b border-white/20`,children:[(0,M.jsx)(i,{className:`w-4 h-4 text-white/80 flex-shrink-0`}),(0,M.jsxs)(`div`,{className:`flex items-center gap-2 text-sm font-medium flex-1 text-shadow`,children:[(0,M.jsx)(`span`,{className:`font-bold`,children:t}),(0,M.jsx)(`span`,{className:`text-white/60`,children:`‚Üí`}),(0,M.jsx)(`span`,{className:`font-bold`,children:n}),(0,M.jsxs)(`span`,{className:`text-xs text-white/70`,children:[`(`,r,`min)`]})]}),m&&(0,M.jsx)(`button`,{onClick:t=>{t.stopPropagation(),N(e.lat,e.lng)},className:`p-1.5 rounded-full bg-white/20 hover:bg-white/30 backdrop-blur-sm transition-all`,title:`Abrir no Google Maps`,children:(0,M.jsx)(h,{className:`w-5 h-5 text-white`})}),!p&&(0,M.jsx)(`button`,{onClick:t=>{t.stopPropagation(),s?.(e.id)},className:`
                  p-1.5 rounded-full backdrop-blur-sm transition-all
                  ${f?`bg-emerald-500/30 hover:bg-emerald-500/40`:`bg-white/20 hover:bg-white/30`}
                `,title:f?`Marcar como n√£o visitado`:`Marcar como visitado`,children:(0,M.jsx)(_,{className:`w-5 h-5 ${f?`text-emerald-300`:`text-white`}`})})]}),(0,M.jsx)(`h3`,{className:`text-lg font-bold mb-2 line-clamp-2 drop-shadow-md text-shadow`,children:e.name}),(0,M.jsxs)(`div`,{className:`flex items-center gap-2 text-sm text-white/80 mb-2 text-shadow`,children:[(0,M.jsx)(g,{className:`w-3.5 h-3.5 flex-shrink-0`}),(0,M.jsxs)(`span`,{children:[e.region?`${e.region}, `:``,e.city]})]}),!p&&(0,M.jsxs)(`div`,{className:`flex items-center gap-2 text-sm mb-3`,children:[(0,M.jsx)(a,{className:`w-3.5 h-3.5 text-emerald-300 flex-shrink-0`}),e.couplePrice?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(`span`,{className:`font-semibold text-emerald-300`,children:S(e.couplePrice,e.currency)}),(0,M.jsxs)(`span`,{className:`text-white/70 text-xs`,children:[`(`,S(e.priceInBRL),`)`]})]}):(0,M.jsx)(`span`,{className:`font-semibold text-emerald-300`,children:`Gratuito`})]}),!p&&(0,M.jsxs)(`div`,{className:`flex flex-wrap gap-2 mb-3`,children:[c&&(0,M.jsx)(`span`,{className:`px-2 py-1 bg-white/20 text-white text-xs rounded-md backdrop-blur-sm`,children:c.label}),e.needsReservation&&e.reservationStatus&&(0,M.jsxs)(`span`,{className:`px-2 py-1 bg-white/20 text-white text-xs rounded-md backdrop-blur-sm flex items-center gap-1`,children:[(0,M.jsx)(`span`,{children:b[e.reservationStatus].icon}),(0,M.jsx)(`span`,{children:b[e.reservationStatus].label})]})]}),o.length>0&&(0,M.jsx)(`div`,{className:`space-y-2 mb-3`,children:o.map((e,t)=>(0,M.jsxs)(`div`,{className:`
                    flex items-start gap-2 text-sm p-2.5 rounded-lg backdrop-blur-sm border
                    ${e.severity===`error`?`bg-red-500/20 border-red-400/40 text-red-200`:`bg-amber-500/20 border-amber-400/40 text-amber-200`}
                  `,children:[(0,M.jsx)(u,{className:`w-4 h-4 flex-shrink-0 mt-0.5`}),(0,M.jsx)(`span`,{className:`font-medium`,children:e.message})]},t))}),e.notes&&(0,M.jsxs)(`div`,{className:`text-sm bg-white/10 p-3 rounded-xl backdrop-blur-sm border border-white/20`,children:[(0,M.jsx)(`span`,{className:`font-semibold`,children:`üí°`}),` `,e.notes]})]})]})]})}function F({segment:e}){let t=()=>{switch(e.travelMode){case`walking`:return(0,M.jsx)(f,{className:`w-4 h-4`});case`driving`:return(0,M.jsx)(o,{className:`w-4 h-4`});case`transit`:return(0,M.jsx)(o,{className:`w-4 h-4`});default:return(0,M.jsx)(l,{className:`w-4 h-4`})}},n=()=>{switch(e.travelMode){case`walking`:return`A p√©`;case`driving`:return`Carro`;case`transit`:return`Transporte`;default:return`Deslocamento`}};return(0,M.jsxs)(`div`,{className:`relative flex items-center pb-6`,children:[(0,M.jsx)(`div`,{className:`absolute left-0 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-slate-400 dark:bg-slate-500 z-10 -translate-x-1/2`,"aria-hidden":!0}),(0,M.jsxs)(`div`,{className:`ml-4 md:ml-6 flex flex-col md:flex-row md:items-center gap-2 md:gap-4 px-4 py-3 rounded-2xl shadow-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 w-full md:w-auto`,children:[(0,M.jsxs)(`div`,{className:`flex items-center gap-2 text-gray-700 dark:text-gray-200`,children:[(0,M.jsx)(`span`,{className:`flex items-center justify-center w-8 h-8 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300`,children:t()}),(0,M.jsx)(`span`,{className:`text-sm md:text-base font-semibold`,children:n()})]}),(0,M.jsx)(`div`,{className:`hidden md:block h-5 w-px bg-gray-200 dark:bg-gray-600`}),(0,M.jsxs)(`div`,{className:`flex items-center gap-3 md:gap-4 text-sm`,children:[(0,M.jsxs)(`div`,{className:`flex items-center gap-1.5 text-gray-600 dark:text-gray-300`,children:[(0,M.jsx)(i,{className:`w-4 h-4 text-gray-500 dark:text-gray-400`}),(0,M.jsx)(`span`,{className:`font-semibold text-gray-900 dark:text-gray-100`,children:e.durationMinutes}),(0,M.jsx)(`span`,{children:`min`})]}),(0,M.jsx)(`span`,{className:`text-gray-300 dark:text-gray-600`,children:`‚Ä¢`}),(0,M.jsxs)(`div`,{className:`flex items-center gap-1 text-gray-600 dark:text-gray-300`,children:[(0,M.jsx)(`span`,{className:`font-semibold text-gray-900 dark:text-gray-100`,children:e.distanceKm.toFixed(1)}),(0,M.jsx)(`span`,{children:`km`})]})]})]})]})}var I=`b996f53f6015bd09f1e15db7dba0ea21`,L=`https://api.openweathermap.org/data/2.5`,R={Tokyo:{lat:35.6762,lon:139.6503},T√≥quio:{lat:35.6762,lon:139.6503},Kyoto:{lat:35.0116,lon:135.7681},Osaka:{lat:34.6937,lon:135.5023},Nara:{lat:34.6851,lon:135.8048},Hiroshima:{lat:34.3853,lon:132.4553},Hakone:{lat:35.2328,lon:139.107},Seoul:{lat:37.5665,lon:126.978},Seul:{lat:37.5665,lon:126.978},Busan:{lat:35.1796,lon:129.0756},Jeju:{lat:33.4996,lon:126.5312},Incheon:{lat:37.4563,lon:126.7052},Daegu:{lat:35.8714,lon:128.6014}};function z(e){let t=e.substring(0,2);return{"01":`‚òÄÔ∏è`,"02":`üå§Ô∏è`,"03":`‚òÅÔ∏è`,"04":`‚òÅÔ∏è`,"09":`üåßÔ∏è`,10:`üå¶Ô∏è`,11:`‚õàÔ∏è`,13:`‚ùÑÔ∏è`,50:`üå´Ô∏è`}[t]||`üå§Ô∏è`}async function B(e){let t=R[e];if(!t)return console.warn(`Coordinates not found for city: ${e}`),[];try{let e=`${L}/forecast?lat=${t.lat}&lon=${t.lon}&appid=${I}&units=metric&lang=pt_br`,n=new AbortController,r=setTimeout(()=>n.abort(),8e3),i=await fetch(e,{signal:n.signal});if(clearTimeout(r),!i.ok)return console.error(`Weather API error:`,i.status),[];let a=await i.json();if(!a.list||a.list.length===0)return[];let o=a.city?.timezone??0,s=e=>{let t=new Date((e+o)*1e3);return{date:t.toISOString().slice(0,10),hour:t.getUTCHours()}},c={};a.list.forEach(e=>{let{date:t,hour:n}=s(e.dt);c[t]||(c[t]=[]),c[t].push({hour:n,item:e})});let l=[];return Object.entries(c).forEach(([e,t])=>{if(t.length===0)return;let n=Math.min(...t.map(e=>e.item.main.temp_min)),r=Math.max(...t.map(e=>e.item.main.temp_max)),i=Math.max(...t.map(e=>e.item.pop||0)),a=(t.find(e=>e.hour===12)||t[Math.floor(t.length/2)]||t[0]).item,o=e=>t.find(t=>t.hour===e)?.item,s=e=>e?{temp:Math.round(e.main.temp),icon:z(e.weather[0].icon),description:e.weather[0].description,pop:e.pop||0}:void 0,c=o(9)||o(6),u=o(15)||o(12),d=o(21)||o(18);l.push({date:e,temp:Math.round(a.main.temp),tempMin:Math.round(n),tempMax:Math.round(r),description:a.weather[0].description,icon:z(a.weather[0].icon),humidity:a.main.humidity,windSpeed:a.wind.speed,pop:i,rain:a.rain?.[`3h`]||0,periods:{...c&&{morning:s(c)},...u&&{afternoon:s(u)},...d&&{evening:s(d)}}})}),l.sort((e,t)=>e.date.localeCompare(t.date))}catch(e){return console.error(`Error fetching weather:`,e),[]}}function V(e){if(!e||typeof e!=`string`)return``;let t=e.trim();if(t.includes(`T`))return t.split(`T`)[0];if(t.includes(`/`)){let e=t.split(`/`).map(e=>e.trim());if(e.length===3){let t=e[2].length===4,n=e[0].length===4;if(t){let[t,n,r]=e;return`${r}-${n.padStart(2,`0`)}-${t.padStart(2,`0`)}`}if(n){let[t,n,r]=e;return`${t}-${n.padStart(2,`0`)}-${r.padStart(2,`0`)}`}}}if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(t)){let[e,n,r]=t.split(`-`);return`${e}-${n.padStart(2,`0`)}-${r.padStart(2,`0`)}`}return t}function H(e,t){let n=V(t);return!n||!e?.length?null:e.find(e=>e.date===n)||null}function U(e){return e.pop>.7?`‚òî Alta chance de chuva - leve guarda-chuva`:e.pop>.4?`üåÇ Possibilidade de chuva - considere levar guarda-chuva`:e.temp>30?`üå°Ô∏è Muito calor - use protetor solar e hidrate-se`:e.temp<10?`üß• Frio - leve casaco`:e.windSpeed>10?`üí® Vento forte - se agasalhe`:e.description.toLowerCase().includes(`neve`)?`‚ùÑÔ∏è Neve - vista roupas apropriadas`:`‚úÖ Clima favor√°vel para passeios`}function W({weather:e}){let t=U(e),n=e.pop>.4,i=e.periods,a=i&&(i.morning||i.afternoon||i.evening);return(0,M.jsxs)(`div`,{className:`
      border-2 rounded-lg p-3 
      ${n?`bg-blue-50 dark:bg-blue-900/30 border-blue-300 dark:border-blue-700`:`bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700`}
    `,children:[(0,M.jsxs)(`div`,{className:`flex items-center justify-between mb-2`,children:[(0,M.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,M.jsx)(`span`,{className:`text-3xl`,children:e.icon}),(0,M.jsxs)(`div`,{children:[(0,M.jsxs)(`div`,{className:`text-2xl font-bold text-gray-900 dark:text-gray-100`,children:[e.tempMin,`¬∞ - `,e.tempMax,`¬∞`]}),(0,M.jsx)(`div`,{className:`text-xs text-gray-600 dark:text-gray-400 capitalize`,children:e.description})]})]}),(0,M.jsx)(`div`,{className:`text-sm text-gray-600 dark:text-gray-400 text-right`,children:(0,M.jsxs)(`div`,{className:`flex items-center gap-1 justify-end`,children:[(0,M.jsx)(m,{className:`w-4 h-4`}),(0,M.jsx)(`span`,{children:`min / max`})]})})]}),a&&(0,M.jsxs)(`div`,{className:`flex flex-wrap items-center gap-x-4 gap-y-1.5 text-sm text-gray-700 dark:text-gray-300 mb-3 pb-2 border-b border-gray-200 dark:border-gray-600`,children:[i.morning&&(0,M.jsxs)(`span`,{className:`flex items-center gap-1.5`,children:[(0,M.jsx)(`span`,{className:`text-xs font-medium text-gray-500 dark:text-gray-400`,children:`Manh√£`}),(0,M.jsx)(`span`,{children:i.morning.icon}),(0,M.jsxs)(`span`,{className:`font-semibold`,children:[i.morning.temp,`¬∞`]}),i.morning.pop>.3&&(0,M.jsxs)(`span`,{className:`text-xs text-blue-600 dark:text-blue-400`,children:[Math.round(i.morning.pop*100),`%`]})]}),i.afternoon&&(0,M.jsxs)(`span`,{className:`flex items-center gap-1.5`,children:[(0,M.jsx)(`span`,{className:`text-xs font-medium text-gray-500 dark:text-gray-400`,children:`Tarde`}),(0,M.jsx)(`span`,{children:i.afternoon.icon}),(0,M.jsxs)(`span`,{className:`font-semibold`,children:[i.afternoon.temp,`¬∞`]}),i.afternoon.pop>.3&&(0,M.jsxs)(`span`,{className:`text-xs text-blue-600 dark:text-blue-400`,children:[Math.round(i.afternoon.pop*100),`%`]})]}),i.evening&&(0,M.jsxs)(`span`,{className:`flex items-center gap-1.5`,children:[(0,M.jsx)(`span`,{className:`text-xs font-medium text-gray-500 dark:text-gray-400`,children:`Noite`}),(0,M.jsx)(`span`,{children:i.evening.icon}),(0,M.jsxs)(`span`,{className:`font-semibold`,children:[i.evening.temp,`¬∞`]}),i.evening.pop>.3&&(0,M.jsxs)(`span`,{className:`text-xs text-blue-600 dark:text-blue-400`,children:[Math.round(i.evening.pop*100),`%`]})]})]}),(0,M.jsxs)(`div`,{className:`flex items-center gap-3 text-xs text-gray-600 dark:text-gray-400 mb-2`,children:[(0,M.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,M.jsx)(r,{className:`w-3 h-3`}),(0,M.jsxs)(`span`,{children:[`at√© `,Math.round(e.pop*100),`% chuva`]})]}),(0,M.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,M.jsx)(d,{className:`w-3 h-3`}),(0,M.jsxs)(`span`,{children:[e.windSpeed.toFixed(1),` m/s`]})]}),(0,M.jsxs)(`div`,{className:`flex items-center gap-1`,children:[`üíß `,e.humidity,`%`]})]}),(0,M.jsx)(`div`,{className:`
        text-xs font-medium p-2 rounded
        ${n?`bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-200`:`bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-200`}
      `,children:t})]})}function G(e){let{data:t=[],isLoading:n,error:r}=v({queryKey:[`weather`,e],queryFn:()=>B(e),staleTime:1e3*60*30,enabled:!!e,retry:1});return{forecast:t,isLoading:n,error:r}}function K({timeline:e,city:t,date:n,onToggleVisited:r}){let a=t??e?.attractions[0]?.city??``,o=n??e?.date??``,{forecast:s}=G(a),l=o&&s.length>0?H(s,w(o)):null;return e?(0,M.jsxs)(`div`,{className:`space-y-6`,children:[o&&(l?(0,M.jsx)(W,{weather:l}):(0,M.jsx)(`div`,{className:`rounded-lg border border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20 p-4 text-amber-800 dark:text-amber-200 text-sm`,children:`Clima n√£o dispon√≠vel para esta data. A previs√£o cobre apenas os pr√≥ximos 5 dias.`})),(0,M.jsx)(`div`,{className:`bg-gradient-to-br from-slate-600 to-slate-700 dark:from-slate-700 dark:to-slate-800 text-white rounded-2xl p-5 md:p-6 shadow-lg`,children:(0,M.jsxs)(`div`,{className:`space-y-4`,children:[(0,M.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,M.jsxs)(`div`,{className:`text-sm font-medium opacity-90 mb-1`,children:[`Dia `,e.dayNumber]}),(0,M.jsx)(`h2`,{className:`text-lg md:text-3xl font-bold mb-2 capitalize`,children:C(e.date)})]}),(0,M.jsxs)(`div`,{className:`flex items-center gap-2 text-base md:text-lg opacity-90`,children:[(0,M.jsx)(i,{className:`w-5 h-5`}),(0,M.jsx)(`span`,{className:`font-semibold`,children:e.startTime}),(0,M.jsx)(`span`,{children:`‚Üí`}),(0,M.jsx)(`span`,{className:`font-semibold`,children:e.endTime})]}),(0,M.jsxs)(`div`,{className:`flex items-center gap-6 pt-4 border-t border-white/20 text-sm md:text-base`,children:[(0,M.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,M.jsx)(g,{className:`w-5 h-5 md:w-6 md:h-6`}),(0,M.jsxs)(`div`,{children:[(0,M.jsx)(`div`,{className:`font-bold text-md:text-xl`,children:e.attractions.length}),(0,M.jsx)(`div`,{className:`text-xs opacity-75`,children:`locais`})]})]}),(0,M.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,M.jsx)(f,{className:`w-5 h-5 md:w-6 md:h-6`}),(0,M.jsxs)(`div`,{children:[(0,M.jsxs)(`div`,{className:`font-bold text-md md:text-xl`,children:[e.totalDistance.toFixed(1),` km`]}),(0,M.jsx)(`div`,{className:`text-xs opacity-75`,children:`dist√¢ncia`})]})]}),(0,M.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,M.jsx)(i,{className:`w-5 h-5 md:w-6 md:h-6`}),(0,M.jsxs)(`div`,{children:[(0,M.jsxs)(`div`,{className:`font-bold text-md md:text-xl`,children:[e.totalTravelTime,`min`]}),(0,M.jsx)(`div`,{className:`text-xs opacity-75`,children:`viagem`})]})]})]}),e.conflicts.length>0&&(0,M.jsxs)(`div`,{className:`mt-4 bg-white/10 backdrop-blur rounded-xl p-4 flex items-start gap-3`,children:[(0,M.jsx)(c,{className:`w-6 h-6 flex-shrink-0 mt-0.5`}),(0,M.jsxs)(`div`,{children:[(0,M.jsxs)(`div`,{className:`font-semibold text-base`,children:[e.conflicts.length,` `,e.conflicts.length===1?`conflito detectado`:`conflitos detectados`]}),(0,M.jsx)(`div`,{className:`text-sm opacity-90 mt-1`,children:`Verifique os avisos abaixo`})]})]})]})}),(0,M.jsxs)(`div`,{className:`relative pl-3 md:pl-6 pt-2`,children:[(0,M.jsx)(`div`,{className:`absolute left-0 top-0 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-700 rounded-full`,"aria-hidden":!0}),(0,M.jsx)(`div`,{className:`space-y-6`,children:e.attractions.map((t,n)=>{let i=n>0?e.segments[n-1]:null,a=e.conflicts.filter(e=>e.attractionId===t.id),o=t.arrivalTime||e.startTime,s=t.departureTime||e.startTime,c=t.duration||60;return(0,M.jsxs)(`div`,{className:`relative`,children:[i&&(0,M.jsx)(F,{segment:i}),(0,M.jsx)(P,{attraction:t,arrivalTime:o,departureTime:s,duration:c,conflicts:a,onToggleVisited:r})]},t.id)})})]})]}):(0,M.jsxs)(`div`,{className:`text-center py-12`,children:[(0,M.jsx)(p,{className:`w-12 h-12 text-gray-400 dark:text-gray-500 mx-auto mb-3`}),(0,M.jsx)(`p`,{className:`text-gray-600 dark:text-gray-400`,children:`Nenhuma atra√ß√£o para mostrar na timeline`}),(0,M.jsx)(`p`,{className:`text-sm text-gray-500 dark:text-gray-400 mt-1`,children:`Adicione atra√ß√µes com coordenadas para visualizar o roteiro`})]})}var q=18,J=210,Y=297,X=5,te=8;function ne(e){return e.duration===0?0:e.duration??60}function Z(e,t,n){let r=t;return r+n>Y-q+20&&(e.addPage(),r=q),r}function Q(e){let t=new O,n=q;t.setFillColor(51,65,85),t.rect(0,0,J,36,`F`),t.setFontSize(22),t.setFont(`helvetica`,`bold`),t.setTextColor(255,255,255),t.text(`Timeline do Roteiro`,J/2,22,{align:`center`}),t.setFontSize(10),t.setFont(`helvetica`,`normal`),t.setTextColor(226,232,240);let r=e.length===1?`Dia ${e[0].dayNumber} ¬∑ ${C(e[0].date)}`:`${e.length} dias ¬∑ ${C(e[0].date)} ‚Äì ${C(e[e.length-1].date)}`;t.text(r,J/2,30,{align:`center`}),n=42,t.setFontSize(8),t.setTextColor(100,116,139),t.setFont(`helvetica`,`normal`);let i=new Date().toLocaleDateString(`pt-BR`,{day:`2-digit`,month:`long`,year:`numeric`,hour:`2-digit`,minute:`2-digit`});t.text(`Gerado em ${i}`,J/2,n,{align:`center`}),n+=8,t.setDrawColor(226,232,240),t.line(q,n,J-q,n),n+=6;for(let r=0;r<e.length;r++){let i=e[r];n=Z(t,n,50),t.setFillColor(71,85,105),t.rect(q,n,J-q*2,20,`F`),t.setFontSize(12),t.setFont(`helvetica`,`bold`),t.setTextColor(255,255,255),t.text(`Dia ${i.dayNumber}`,q+5,n+8),t.setFontSize(9),t.setFont(`helvetica`,`normal`),t.setTextColor(226,232,240),t.text(C(i.date),q+5,n+14),t.setFontSize(9),t.text(`${i.startTime} - ${i.endTime}`,J-q-6,n+11,{align:`right`}),n+=24,t.setFontSize(8),t.setTextColor(100,116,139),t.setFont(`helvetica`,`normal`),t.text(`${i.attractions.length} locais`,q,n),t.text(`${i.totalDistance.toFixed(1)} km`,q+40,n),t.text(`${i.totalTravelTime} min viagem`,q+75,n),n+=X+2,t.setFont(`helvetica`,`bold`),t.setFontSize(9),t.setTextColor(30,41,59),t.text(`Roteiro`,q,n),n+=X+1;for(let e=0;e<i.attractions.length;e++){if(n=Z(t,n,X*4),e>0&&i.segments[e-1]){let r=i.segments[e-1];t.setFontSize(7),t.setFont(`helvetica`,`normal`),t.setTextColor(148,163,184),t.text(`${r.distanceKm.toFixed(1)} km, ~${r.durationMinutes} min ate ${r.to.name}`,q+8,n),n+=X+1}let r=i.attractions[e],a=r.arrivalTime??i.startTime,o=r.departureTime??i.startTime,s=ne(r),c=r.id===-999;n=Z(t,n,X*2+6);let l=X+5;t.setFillColor(248,250,252),t.rect(q,n-3,J-q*2,l,`F`),t.setFontSize(9),t.setFont(`helvetica`,`bold`),t.setTextColor(51,65,85),t.text(`${e+1}. ${r.name}`,q+5,n+1.5),t.setFont(`helvetica`,`normal`),t.setFontSize(8),t.setTextColor(100,116,139),t.text(`${a} - ${o}`,J-q-5,n+1.5,{align:`right`}),r.city&&t.text(r.city,q+5,n+1.5+X),!c&&s>0&&t.text(`${s} min`,J-q-5,n+1.5+X,{align:`right`}),n+=l+2}if(i.conflicts.length>0){let e=5+i.conflicts.length*(X+.5);n=Z(t,n,e+4),t.setFillColor(254,226,226),t.roundedRect(q,n,J-q*2,e,1.5,1.5,`F`),t.setFontSize(8),t.setFont(`helvetica`,`bold`),t.setTextColor(185,28,28),t.text(`Aten√ß√£o: ${i.conflicts.length} conflito(s)`,q+5,n+4),t.setFont(`helvetica`,`normal`),t.setFontSize(7),t.setTextColor(127,29,29),i.conflicts.forEach((e,r)=>{t.text(`‚Ä¢ ${e.message}`,q+5,n+4+(r+1)*(X+.5))}),n+=e+2}n+=te}let a=Y-12;t.setFontSize(8),t.setTextColor(148,163,184),t.text(`Trip Planner ¬∑ Timeline do Roteiro`,J/2,a,{align:`center`});let o=e.length===1?`timeline-dia-${e[0].dayNumber}-${w(e[0].date)}.pdf`:`timeline-roteiro-${new Date().toISOString().split(`T`)[0]}.pdf`;t.save(o)}function $(e,t){if(e.length===0||t.length===0)return e;let n=e[0].city,r=t.find(e=>e.city===n);return!r?.lat||!r?.lng?e:[{id:-999,name:r.description,lat:r.lat,lng:r.lng,city:r.city,region:e[0].region,country:r.country,order:0,date:e[0].date,day:e[0].day,dayOfWeek:e[0].dayOfWeek,type:`other`,duration:0,couplePrice:0,priceInBRL:0,currency:e[0].currency,visited:!1,needsReservation:!1,openingTime:void 0,closingTime:void 0,imageUrl:void 0},...e]}function re(){let{country:e,day:t,accommodations:r,attractions:i,isReady:a}=T(),{toggleVisited:o}=ee(e),{segmentsByDay:c,isRoutesLoading:l}=A((0,j.useMemo)(()=>{let e={};return i.filter(e=>e.lat!=null&&e.lng!=null).forEach(t=>{e[t.day]||(e[t.day]=[]),e[t.day].push(t)}),e},[i]),r),{success:u,error:d}=y(),[f,m]=(0,j.useState)(!1),h=async e=>{try{await o(e),u(`Status da atra√ß√£o atualizado`)}catch(e){d(`Erro ao atualizar atra√ß√£o`),console.error(e)}},g=(0,j.useMemo)(()=>i.filter(e=>e.lat&&e.lng),[i]),_=(0,j.useMemo)(()=>g.length===0||t===`all`?[]:$(g.filter(e=>e.day===t),r),[g,t,r]),v=(0,j.useMemo)(()=>{if(t!==`all`||g.length===0)return[];let e={};return g.forEach(t=>{e[t.day]||(e[t.day]=[]),e[t.day].push(t)}),Object.keys(e).map(Number).sort((e,t)=>e-t).map(t=>{let n=e[t],i=$(n,r);return{day:t,date:n[0].date,attractions:i}})},[t,g,r]),b=(0,j.useMemo)(()=>t===`all`?v.length===0?`Todos os dias`:`${v.length} ${v.length===1?`dia`:`dias`}`:_.length===0?``:`Dia ${t}`,[t,v.length,_.length]),x=t===`all`?v.length>0:_.length>0,S=(0,j.useMemo)(()=>t===`all`?JSON.stringify(v.map(e=>({day:e.day,ids:e.attractions.map(e=>e.id)}))):JSON.stringify(_.map(e=>e.id)),[t,v,_]),[C,w]=(0,j.useState)(null),[O,N]=(0,j.useState)([]),[P,F]=(0,j.useState)(!1);return(0,j.useEffect)(()=>{if(l)return;if(t!==`all`){if(_.length===0){w(null),F(!1);return}let e=!1;F(!0),N([]);let n=c[Number(t)];return k(_,n&&n.length===_.length-1?n:void 0).then(t=>{e||w(t)}).finally(()=>{e||F(!1)}),()=>{e=!0}}if(v.length===0){N([]),w(null),F(!1);return}let e=!1;return F(!0),w(null),Promise.all(v.map(e=>{let t=c[e.day],n=t&&t.length===e.attractions.length-1?t:void 0;return k(e.attractions,n)})).then(t=>{e||N(t)}).finally(()=>{e||F(!1)}),()=>{e=!0}},[S,c,l]),a?(0,M.jsxs)(`div`,{className:`min-h-screen bg-gray-50 dark:bg-gray-900 pb-20 md:pb-6`,children:[(0,M.jsx)(E,{title:`Timeline`,subtitle:`${b} - Visualize seu dia com rotas e clima`,filter:(0,M.jsx)(D,{hideGeneralOption:!0}),action:x?(0,M.jsxs)(`button`,{type:`button`,onClick:async()=>{if(x){m(!0);try{if(t===`all`){let e=(O.length===v.length?O:await Promise.all(v.map(e=>{let t=c[e.day],n=t&&t.length===e.attractions.length-1?t:void 0;return k(e.attractions,n)}))).filter(e=>e!=null);e.length>0?(Q(e),u(`PDF exportado com sucesso!`)):d(`Nenhuma timeline gerada para exportar`)}else{let e=c[Number(t)],n=e&&e.length===_.length-1?e:void 0,r=C??await k(_,n);r?(Q([r]),u(`PDF exportado com sucesso!`)):d(`Nenhuma timeline gerada para exportar`)}}catch(e){console.error(e),d(`Erro ao exportar PDF`)}finally{m(!1)}}},disabled:f,className:`flex items-center gap-2 px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 text-white text-sm font-medium transition-colors disabled:opacity-60 disabled:cursor-not-allowed`,title:`Exportar timeline em PDF`,children:[(0,M.jsx)(s,{className:`w-4 h-4`}),f?`Exportando‚Ä¶`:`Exportar PDF`]}):void 0}),(0,M.jsxs)(`main`,{className:`max-w-6xl mx-auto px-4 md:px-6 py-6`,children:[!1,(t===`all`?v.length===0:_.length===0)?(0,M.jsxs)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-12 text-center`,children:[(0,M.jsx)(p,{className:`w-16 h-16 text-gray-400 mx-auto mb-4`}),(0,M.jsx)(`h3`,{className:`text-xl font-bold text-gray-900 dark:text-gray-100 mb-2`,children:t===`all`?`Nenhuma atra√ß√£o com coordenadas`:`Nenhuma atra√ß√£o para o Dia ${t}`}),(0,M.jsx)(`p`,{className:`text-gray-600 dark:text-gray-400 mb-4`,children:t===`all`?`Adicione coordenadas (lat/lng) √†s suas atra√ß√µes para visualizar as timelines por dia`:`Adicione coordenadas (lat/lng) √†s suas atra√ß√µes para visualizar a timeline`}),(0,M.jsx)(n,{to:`/attractions`,className:`inline-block px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors`,children:`Ir para Atra√ß√µes`})]}):l?(0,M.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-8 text-center`,children:(0,M.jsx)(`p`,{className:`text-gray-500 dark:text-gray-400 text-sm`,children:`Carregando rotas em segundo plano...`})}):P?(0,M.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-12 flex items-center justify-center min-h-[200px]`,children:(0,M.jsx)(`div`,{className:`animate-spin rounded-full h-12 w-12 border-2 border-gray-200 dark:border-gray-700 border-t-slate-600 dark:border-t-slate-400`})}):t===`all`?(0,M.jsx)(`div`,{className:`space-y-10`,children:v.map((e,t)=>(0,M.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-6`,children:(0,M.jsx)(K,{timeline:O[t]??null,city:e.attractions[0]?.city,date:e.date,onToggleVisited:h})},e.day))}):(0,M.jsx)(`div`,{className:`bg-white dark:bg-gray-800 rounded-xl shadow-md p-6`,children:(0,M.jsx)(K,{timeline:C,city:_[0]?.city,date:_[0]?.date,onToggleVisited:h})})]}),(t===`all`?v.length>0:_.length>0)&&(0,M.jsx)(`div`,{className:`max-w-6xl mx-auto px-6 pb-6`,children:(0,M.jsxs)(`div`,{className:`bg-blue-50 border border-blue-200 rounded-lg p-4`,children:[(0,M.jsxs)(`h4`,{className:`font-semibold text-blue-900 mb-2 flex items-center gap-2`,children:[(0,M.jsx)(p,{className:`w-4 h-4`}),`Como funciona a Timeline`]}),(0,M.jsxs)(`ul`,{className:`text-sm text-blue-800 space-y-1`,children:[(0,M.jsx)(`li`,{children:`‚Ä¢ Rotas calculadas automaticamente usando OSRM`}),(0,M.jsx)(`li`,{children:`‚Ä¢ Tempo de deslocamento estimado com base na dist√¢ncia`}),(0,M.jsx)(`li`,{children:`‚Ä¢ Conflitos detectados automaticamente (hor√°rios, fechamentos)`}),(0,M.jsx)(`li`,{children:`‚Ä¢ Dura√ß√£o: use o campo "Dura√ß√£o" da atra√ß√£o (padr√£o: 60min se n√£o informado)`}),(0,M.jsx)(`li`,{children:`‚Ä¢ Use o filtro na home para selecionar o dia da timeline`})]})]})})]}):(0,M.jsx)(`div`,{className:`min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center`,children:(0,M.jsx)(`div`,{className:`animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600`})})}export{re as default};