import{C as e,S as t,b as n,c as r,o as i,u as a,x as o}from"./google-login-button-CK2bO50y.js";import{a as s,n as c,o as l,s as u,t as d}from"./zod-BU_exWGf.js";import{A as f,J as p,L as m,M as h,N as g,P as _,V as v,j as y,m as b}from"./index-BcH8idzW.js";import{i as x,n as S,r as C,t as w}from"./validateWithToast-DEDJtjiG.js";import{t as T}from"./useCurrency-CPfq3DxC.js";import{t as E}from"./DateField-BP8CCOyG.js";var D=c([`accommodation`,`transport`,`food`,`attraction`,`shopping`,`other`],{message:`Categoria é obrigatória.`}),O=c([`JPY`,`KRW`,`BRL`],{message:`Moeda é obrigatória.`}),k=c([`Diego`,`Pamela`,`Casal`,`Alimentação`,`Atrações`,`Transporte`],{message:`A Origem do pagamento é obrigatória.`}),A=c([`japan`,`south-korea`,`general`],{message:`O País é obrigatório.`});const j=l({category:D,description:u().trim().min(1,`A Descrição é obrigatória`),amount:s().positive(`O Valor é obrigatório`),currency:O,amountInBRL:s().min(0),budgetOrigin:k,date:d({message:`A Data é obrigatória`}),country:A,notes:u().optional(),receiptUrl:u().optional()});j.extend({id:s({message:`ID é obrigatório.`})});var M=e(),N=t();function P(e){return e===`BRL`?`general`:Object.entries(r).find(([t,n])=>n.currency===e)?.[0]}function F({expense:e,isOpen:t,onClose:s,onSave:c}){let l=p(),[u,d]=(0,M.useState)(!1),{register:D,control:O,handleSubmit:k,watch:A,setValue:F,reset:I}=x({defaultValues:{category:`food`,description:``,amount:``,currency:`BRL`,amountInBRL:0,budgetOrigin:`Casal`,date:new Date().toISOString().split(`T`)[0],country:`general`,notes:``,receiptUrl:``}}),L=A(),R=(0,M.useRef)(L.currency),z=(0,M.useRef)(L.country),B=(0,M.useRef)(!0),{rates:V}=T();return(0,M.useEffect)(()=>{if(t)if(B.current=!0,e){let t=a[e.category]?e.category:o(e.category),r=i[e.budgetOrigin]?e.budgetOrigin:n(e.budgetOrigin),s;s=e.currency===`BRL`?m(Math.round(e.amount*100).toString(),e.currency):m(e.amount.toString(),e.currency),I({category:t,description:e.description,amount:s,currency:e.currency,amountInBRL:e.amountInBRL,budgetOrigin:r,date:g(e.date),country:e.country??(e.currency===`BRL`?`general`:void 0),notes:e.notes||``,receiptUrl:e.receiptUrl||``}),R.current=e.currency,z.current=e.country??(e.currency===`BRL`?`general`:void 0)}else I({category:`food`,description:``,amount:``,currency:`BRL`,amountInBRL:0,budgetOrigin:`Casal`,date:new Date().toISOString().split(`T`)[0],country:`general`,notes:``,receiptUrl:``}),R.current=`BRL`,z.current=`general`},[t,e,I]),(0,M.useEffect)(()=>{if(B.current){B.current=!1;return}let e=z.current!==L.country,t=R.current!==L.currency;if(e&&L.country){let e=r[L.country];e?.currency&&L.currency!==e.currency&&F(`currency`,e.currency)}else if(t&&!e){let e=P(L.currency);L.country!==e&&F(`country`,e)}z.current=L.country},[L.country,L.currency,F]),(0,M.useEffect)(()=>{if(R.current!==L.currency&&L.amount){let e=typeof L.amount==`string`?h(L.amount,R.current):L.amount;if(e>0){let t=f(e,R.current,L.currency,V),n;n=L.currency===`BRL`?m(Math.round(t*100).toString(),L.currency):m(Math.round(t).toString(),L.currency),F(`amount`,n)}}R.current=L.currency},[L.currency,L.amount,F]),(0,M.useEffect)(()=>{F(`amountInBRL`,y(typeof L.amount==`string`?h(L.amount,L.currency):L.amount,L.currency,V))},[L.amount,L.currency,F]),(0,N.jsx)(S,{isOpen:t,onClose:s,title:e?`Editar Gasto`:`Novo Gasto`,type:e?`edit`:`create`,onSave:k(async e=>{let t=typeof e.amount==`string`?h(e.amount,e.currency):e.amount,n={...e,amount:t,amountInBRL:e.amountInBRL,country:e.country};if(w(n,j,l)){d(!0);try{await Promise.resolve(c(n)),s()}finally{d(!1)}}}),loading:u,loadingText:`Salvando...`,size:`lg`,children:(0,N.jsxs)(`div`,{className:`space-y-4`,children:[(0,N.jsxs)(`div`,{children:[(0,N.jsx)(`label`,{htmlFor:`expense-category`,className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Categoria *`}),(0,N.jsx)(`div`,{className:`grid grid-cols-3 gap-3`,children:Object.entries(a).map(([e,t])=>(0,N.jsxs)(`button`,{type:`button`,onClick:()=>F(`category`,e),className:`p-4 rounded-lg border-2 transition-all focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none ${L.category===e?`border-red-500 bg-red-50 dark:bg-red-900/40 shadow-md`:`border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500`}`,children:[(0,N.jsx)(`div`,{className:`text-2xl mb-1`,children:t.icon}),(0,N.jsx)(`div`,{className:`font-semibold text-sm ${L.category===e?`text-red-700 dark:text-red-300`:`text-gray-700 dark:text-gray-300`}`,children:t.label})]},e))})]}),(0,N.jsxs)(`div`,{children:[(0,N.jsx)(`label`,{htmlFor:`expense-description`,className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Descrição *`}),(0,N.jsx)(`input`,{id:`expense-description`,type:`text`,autoComplete:`off`,...D(`description`),className:`w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`Ex: Almoço no restaurante`})]}),(0,N.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,N.jsxs)(`div`,{children:[(0,N.jsx)(`label`,{htmlFor:`expense-country`,className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`País *`}),(0,N.jsx)(b,{value:L.country?`${r[L.country].flag} ${r[L.country].name}`:``,onChange:e=>{if(!e){F(`country`,void 0);return}let t=Object.entries(r).find(([t,n])=>`${n.flag} ${n.name}`===e)?.[0];t&&F(`country`,t)},options:[``,...Object.entries(r).map(([e,t])=>`${t.flag} ${t.name}`)].filter(Boolean),placeholder:`Selecione o país`})]}),(0,N.jsxs)(`div`,{children:[(0,N.jsx)(`label`,{htmlFor:`expense-currency`,className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Moeda *`}),(0,N.jsx)(b,{value:L.currency===`BRL`?`R$ Real (BRL)`:L.currency===`JPY`?`¥ Iene (JPY)`:`₩ Won (KRW)`,onChange:e=>{F(`currency`,{"R$ Real (BRL)":`BRL`,"¥ Iene (JPY)":`JPY`,"₩ Won (KRW)":`KRW`}[e])},options:[`R$ Real (BRL)`,`¥ Iene (JPY)`,`₩ Won (KRW)`]})]})]}),(0,N.jsxs)(`div`,{children:[(0,N.jsx)(`label`,{htmlFor:`expense-amount`,className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Valor *`}),(0,N.jsx)(C,{name:`amount`,control:O,render:({field:e})=>(0,N.jsx)(`input`,{id:`expense-amount`,type:`text`,autoComplete:`off`,value:typeof e.value==`number`?m(e.value.toString(),L.currency):e.value,onChange:t=>{let n=m(t.target.value,L.currency);e.onChange(n)},className:`w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:L.currency===`BRL`?`R$ 0,00`:L.currency===`JPY`?`¥ 0`:`₩ 0`})})]}),(0,N.jsxs)(`div`,{children:[(0,N.jsx)(`label`,{htmlFor:`expense-date`,className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Data *`}),(0,N.jsx)(C,{name:`date`,control:O,render:({field:e})=>(0,N.jsx)(E,{value:e.value?v(e.value):void 0,onChange:t=>e.onChange(t?_(t):``)})})]}),L.currency!==`BRL`&&L.amount&&(typeof L.amount==`string`?h(L.amount,L.currency)>0:L.amount>0)&&(0,N.jsxs)(`div`,{className:`bg-blue-50 dark:bg-blue-900/30 p-3 rounded-lg border border-blue-200 dark:border-blue-700`,children:[(0,N.jsx)(`span`,{className:`text-sm text-blue-700 dark:text-blue-200`,children:`Valor em reais: `}),(0,N.jsx)(`span`,{className:`font-bold text-blue-900 dark:text-blue-100`,children:new Intl.NumberFormat(`pt-BR`,{style:`currency`,currency:`BRL`}).format(L.amountInBRL||0)})]}),(0,N.jsxs)(`div`,{children:[(0,N.jsx)(`label`,{htmlFor:`expense-budget-origin`,className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Origem do Pagamento *`}),(0,N.jsx)(`div`,{className:`grid grid-cols-3 gap-3`,children:Object.entries(i).map(([e,t])=>(0,N.jsxs)(`button`,{type:`button`,onClick:()=>F(`budgetOrigin`,e),className:`p-4 rounded-lg border-2 transition-all focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none ${L.budgetOrigin===e?`border-current shadow-md`:`border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500 bg-white dark:bg-gray-800`}`,style:{borderColor:L.budgetOrigin===e?t.color:void 0,backgroundColor:L.budgetOrigin===e?`${t.color}10`:void 0},children:[(0,N.jsx)(`div`,{className:`text-2xl mb-1`,children:t.icon}),(0,N.jsx)(`div`,{className:`font-semibold text-gray-500 dark:text-gray-300`,style:{color:L.budgetOrigin===e?t.color:void 0},children:t.label})]},e))})]}),(0,N.jsxs)(`div`,{children:[(0,N.jsx)(`label`,{htmlFor:`expense-notes`,className:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5`,children:`Observações`}),(0,N.jsx)(`textarea`,{id:`expense-notes`,...D(`notes`),rows:3,autoComplete:`off`,className:`w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-500 focus:outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100`,placeholder:`Anotações adicionais sobre este gasto...`})]})]})})}export{F as t};